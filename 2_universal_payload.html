

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>2. Universal Payload &mdash; Universal Scalable Firmware (USF)  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Platform Orchestration Layer (POL)" href="3_platform_orchestration_layer.html" />
    <link rel="prev" title="1. Universal Scalable Firmware (USF) Specification" href="1_terminology.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Universal Scalable Firmware (USF)
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="revision_history.html">Revision History</a></li>
<li class="toctree-l1"><a class="reference internal" href="disclaimers.html">Notices and Disclaimers</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_terminology.html">1. Universal Scalable Firmware (USF) Specification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Universal Payload</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#purpose">2.1. Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#intended-audience">2.2. Intended Audience</a></li>
<li class="toctree-l2"><a class="reference internal" href="#related-documents">2.3. Related Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#universal-payload-overview">2.4. Universal Payload Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bootloaders">2.5. Bootloaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="#payload-modules">2.6. Payload Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bootloader-interfaces">2.7. Bootloader Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coreboot-payload-interface">2.7.1. Coreboot Payload Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slim-bootloader-sbl-payload-interface">2.7.2. Slim Bootloader (SBL) Payload Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pei-to-dxe-interface">2.7.3. PEI to DXE Interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#os-interfaces">2.8. OS interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#os-boot-protocols">2.8.1. OS Boot protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-interface">2.8.2. Data interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#payload-principle">2.9. Payload principle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#payload-security">2.10. Payload Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="#payload-image-format">2.11. Payload Image Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#payload-image-sections">2.11.1. Payload Image Sections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#universal-payload-information-section">2.11.2. Universal Payload Information Section</a></li>
<li class="toctree-l3"><a class="reference internal" href="#universal-payload-loaded-image-section">2.11.3. Universal Payload Loaded Image Section</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hand-off-state">2.12. Hand-off state</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ia-32-and-x64-platforms">2.12.1. IA-32 and x64 Platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#state-of-silicon">2.12.1.1. State of silicon</a></li>
<li class="toctree-l4"><a class="reference internal" href="#instruction-execution-environment">2.12.1.2. Instruction execution environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#arm-platforms">2.12.2. ARM Platforms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#risc-v-platforms">2.12.3. RISC-V Platforms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#payload-interfaces">2.13. Payload Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#acpi-tables">2.13.1. ACPI tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hob-list">2.13.2. HOB List</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reusing-interfaces-in-platform-initialization-specification">2.13.2.1. Reusing Interfaces in Platform Initialization Specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#new-interfaces">2.13.2.2. New Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-interfaces">2.13.2.3. Optional Interfaces</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hob-data-structures">2.14. HOB Data Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#base-data-type">2.14.1. Base Data Type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#efi-hob-type">2.14.2. EFI HOB TYPE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#efi-hob-generic-header">2.14.3. EFI_HOB_GENERIC_HEADER</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hob-list-header">2.14.4. HOB List Header</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#efi-hob-handoff-info-table">2.14.4.1. EFI_HOB_HANDOFF_INFO_TABLE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#efi-hob-handoff-table-version">2.14.4.2. EFI_HOB_HANDOFF_TABLE_VERSION</a></li>
<li class="toctree-l4"><a class="reference internal" href="#efi-boot-mode">2.14.4.3. EFI_BOOT_MODE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#efi-hob-guid-type">2.14.5. EFI_HOB_GUID_TYPE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#efi-pei-graphics-info-hob">2.14.6. EFI_PEI_GRAPHICS_INFO_HOB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#efi-pei-graphics-device-info-hob">2.14.7. EFI_PEI_GRAPHICS_DEVICE_INFO_HOB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#efi-hob-resource-descriptor">2.14.8. EFI_HOB_RESOURCE_DESCRIPTOR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#efi-resource-type">2.14.8.1. EFI_RESOURCE_TYPE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#efi-resource-attribute-type">2.14.8.2. EFI_RESOURCE_ATTRIBUTE_TYPE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#efi-hob-resource-descriptor-1">2.14.8.3. EFI_HOB_RESOURCE_DESCRIPTOR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#efi-hob-memory-allocation">2.14.9. EFI_HOB_MEMORY_ALLOCATION</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#efi-memory-type">2.14.9.1. EFI_MEMORY_TYPE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#efi-hob-memory-allocation-header">2.14.9.2. EFI_HOB_MEMORY_ALLOCATION_HEADER</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">2.14.9.3. EFI_HOB_MEMORY_ALLOCATION</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#future-interface">2.15. Future Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cbor-encoded-data">2.15.1. CBOR encoded data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fdt-data-structure">2.15.2. FDT data structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">2.15.3. Hand-off state</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references-and-links">2.16. References and Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3_platform_orchestration_layer.html">3. Platform Orchestration Layer (POL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_runtime.html">4. Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_security.html">5. Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_debug.html">6. Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_yaml_boot_configuration.html">7. YAML Format Boot Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_scalable_fsp.html">8. Scalable FSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_bootloader_payloads.html">9. Bootloader Payloads</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Universal Scalable Firmware (USF)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">2. </span>Universal Payload</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="universal-payload">
<span id="id1"></span><h1><span class="section-number">2. </span>Universal Payload<a class="headerlink" href="#universal-payload" title="Permalink to this heading">¶</a></h1>
<p>February 1, 2023</p>
<section id="purpose">
<span id="id2"></span><h2><span class="section-number">2.1. </span>Purpose<a class="headerlink" href="#purpose" title="Permalink to this heading">¶</a></h2>
<p>The purpose of this document is to describe the architecture and interfaces between the bootloader and the payload. Bootloader or payload implementation specific details are outside the scope of this document.</p>
</section>
<section id="intended-audience">
<span id="id3"></span><h2><span class="section-number">2.2. </span>Intended Audience<a class="headerlink" href="#intended-audience" title="Permalink to this heading">¶</a></h2>
<p>This document is targeted at all platform and system developers who need the bootloader or payload to support the unified bootloader and payload interface. This includes firmware developers, bootloader developers, system integrators, and end users.</p>
</section>
<section id="related-documents">
<span id="id4"></span><h2><span class="section-number">2.3. </span>Related Documents<a class="headerlink" href="#related-documents" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>Unified Extensible Firmware Interface (UEFI) Specification</p>
<p><a class="reference external" href="http://www.uefi.org/specifications">http://www.uefi.org/specifications</a></p>
</li>
<li><p>Platform Initialization (PI) Specification</p>
<p><a class="reference external" href="https://uefi.org/specifications">https://uefi.org/specifications</a></p>
</li>
<li><p>Portable Executable (PE) and Common Object File Format (COFF)</p>
<p><a class="reference external" href="https://docs.microsoft.com/en-us/windows/win32/debug/pe-format">https://docs.microsoft.com/en-us/windows/win32/debug/pe-format</a></p>
</li>
<li><p>PE authentication</p>
<p><a class="reference external" href="https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx">https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx</a></p>
</li>
<li><p>ACPI DBG2 table</p>
<p><a class="reference external" href="http://download.microsoft.com/download/9/4/5/945703CA-EF1F-496F-ADCF-3332CE5594FD/microsoft-debug-port-table-2-CP.docx">http://download.microsoft.com/download/9/4/5/945703CA-EF1F-496F-ADCF-3332CE5594FD/microsoft-debug-port-table-2-CP.docx</a></p>
</li>
<li><p>ACPI specification</p>
<p><a class="reference external" href="https://uefi.org/specifications">https://uefi.org/specifications</a></p>
</li>
<li><p>Devicetree specification</p>
<p><a class="reference external" href="https://www.devicetree.org/specifications/">https://www.devicetree.org/specifications/</a></p>
</li>
</ul>
</section>
<section id="universal-payload-overview">
<span id="overview"></span><h2><span class="section-number">2.4. </span>Universal Payload Overview<a class="headerlink" href="#universal-payload-overview" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>Most modern platforms rely on system firmware to initialize the
hardware and launch an Operating System (OS). The system firmware is
responsible for initializing the platform hardware including CPU and
other silicon functional blocks, detecting and initializing the
memory subsystem, boot media initialization and setting up hardware
abstractions for use by the operating systems.</p>
<p>While newer architectural enhancements such as PCI, PCIe, and USB
are developed at an industrial scale, there are vendor specific
micro-architectural enhancements that happens at a much faster pace.
Silicon vendors differentiate through these microarchitectural
enhancements and these features are often considered intellectual
property and rely on system specific firmware initialization. The
system firmware thus provides the necessary abstraction and allows a
generic operating system to run on different platform configurations
and technologies without needing any changes to the operating system
itself.</p>
<p>A design methodology of viewing system firmware functionality as made
up of two distinct phases (<strong>initialization</strong> and <strong>OS boot logic</strong>)
is gaining traction resulting in newer implementations of system
firmware. This approach calls for modular phases with an
initialization phase (bootloader) which completes the system
initialization and gets the hardware to a usable state and then a
payload phase. The payload can provide/implement many different
functionalities including media and file system drivers, operating
system boot, diagnostics, etc.</p>
<p>While certain system firmware implementations implement both the
initialization and OS boot logic in a single code base, the
distinction lies in the functionality provided.</p>
<p>This specification describes an interface between the
bootloader phase that initializes the system hardware and the payload
phase. It includes how to pass parameters to the payload and parameter
format, payload image format, payload boot mode and stack usage, etc.
The intent for this specification is to provide interoperability
between spec compliant bootloaders and spec compliant payloads.</p>
</div></blockquote>
<img alt="_images/design.png" src="_images/design.png" />
</section>
<section id="bootloaders">
<span id="id5"></span><h2><span class="section-number">2.5. </span>Bootloaders<a class="headerlink" href="#bootloaders" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>Bootloaders are primarily responsible for initializing the system
hardware including, but not limited to CPU initialization, memory
detection and initialization, initialization of silicon functional
units (IO controllers), bus topology configuration, etc. In addition
to the initialization itself, bootloader is responsible for providing
the system configuration information to the subsequent stages in the
boot process. In addition to proprietary options, there are many open
sourced bootloaders available.</p>
<p><strong>EDK II</strong></p>
<p>TianoCore EDK II is a modern feature-rich, cross-platform firmware development
environment for the UEFI and UEFI Platform Initialization (PI)
specifications. EDKII performs both first stage (hardware
initialization) and second stage booting.</p>
<p>Reference implementations for many platforms are also available in
open source, under BSD + Patents license.</p>
<p><a class="reference external" href="https://www.tianocore.org/">https://www.tianocore.org/</a></p>
<p><strong>Slim Bootloader</strong></p>
<p>Slim Bootloader is an open source system firmware implementation that
adopts the modular initialization followed by payload launch approach
of system firmware design. Slim Bootloader provides both the
initialization phase and OsLoader payload, and it also
supports launching of different payloads. Open source Slim Bootloader
uses a BSD + Patents License.</p>
<p><a class="reference external" href="https://slimbootloader.github.io/">https://slimbootloader.github.io/</a></p>
<p><strong>coreboot</strong></p>
<p>Coreboot is a project to develop open source boot firmware for
various architectures. It follows the design philosophy of minimum
necessary initialization followed by payload. Coreboot is released
under GNU’s General Public License (GPL).</p>
<p><a class="reference external" href="https://www.coreboot.org/">https://www.coreboot.org/</a></p>
<p><strong>U-Boot</strong></p>
<p>U-Boot is an open-source, primary bootloader used in embedded
devices. U-Boot performs both first stage (hardware initialization)
and second stage booting. U-boot is released under GNU’s General
Public License (GPL)</p>
<p><a class="reference external" href="https://www.denx.de/wiki/U-Boot/WebHome">https://www.denx.de/wiki/U-Boot/WebHome</a></p>
</div></blockquote>
</section>
<section id="payload-modules">
<span id="payloads"></span><h2><span class="section-number">2.6. </span>Payload Modules<a class="headerlink" href="#payload-modules" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>After initializing the system hardware, bootloaders launch the
payload modules. Payloads ideally are modular and platform
independent. Payloads depend on abstract interfaces (scope of
this document) to be platform independent.</p>
<p>While OS boot protocol is one of the main functionalities provided by
payloads, there could be other functionalities such as diagnostics
that can be enabled by payloads.</p>
<p>From a design point of view, a payload is different from a boot image
based on its relationship with the system firmware. Payloads are
considered part of system firmware and are typically in flash memory,
while boot images are not considered part of system firmware (not
within the trusted firmware boundary) and are often in separate boot media.</p>
<p>As mentioned earlier, while certain system firmware
implementations include both the initialization and OS boot logic
in a single code base, the distinction lies in the functionality
provided. This leads to use cases where some system firmware
implementations can act as a payload providing OS boot capability,
while relying on an underlying bootloader layer for system hardware
initialization. Examples of such payloads include TianoCore EDKII and U-boot.
Both EDKII and uboot implementations include both phases of system
firmware functionality, and can also be launched as payloads by other
bootloaders.</p>
<p>There are many payloads currently available, including the EDKII UEFI payload,
Linux payload, u-boot payload and other custom payload implementations.</p>
<p><strong>EDK II Payload</strong></p>
<p>EDK II DXE and BDS stages can be launched by bootloaders as a UEFI
payload. The EDK II payload provides the required UEFI specification
defined architectural protocols, and can launch a UEFI aware OS.</p>
<p><strong>SBL OsLoader</strong></p>
<p>This is an SBL payload implementation that supports the Linux boot protocol, and
can also launch ELF or PE executables. It also supports launching an OS
compliant with the Multi-Boot specification.</p>
<p><strong>Linux Payload</strong></p>
<p>LinuxBoot is firmware for modern servers that replaces specific
firmware functionality, like the UEFI DXE phase with a Linux kernel
and runtime.</p>
<p><a class="reference external" href="https://www.linuxboot.org/">https://www.linuxboot.org/</a></p>
<p><strong>VaultBoot Payload</strong>
VaultBoot is a firmware security payload highly focus on trusted computing
and advanced defense, e.g: Verified boot (also known as Secure Boot) and
measured boot, TPMv2 based FDE (Full-disk encryption), local/remote
attestation, built-in DH key exchange against physical attack such as TPM Genie.</p>
<p><a class="reference external" href="https://github.com/hardenedvault/vaultboot">https://github.com/hardenedvault/vaultboot</a></p>
</div></blockquote>
</section>
<section id="bootloader-interfaces">
<span id="id6"></span><h2><span class="section-number">2.7. </span>Bootloader Interfaces<a class="headerlink" href="#bootloader-interfaces" title="Permalink to this heading">¶</a></h2>
<section id="coreboot-payload-interface">
<h3><span class="section-number">2.7.1. </span>Coreboot Payload Interface<a class="headerlink" href="#coreboot-payload-interface" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><strong>Reference</strong>: <a class="reference external" href="https://www.coreboot.org/API">https://www.coreboot.org/API</a></p>
<p><strong>Reference</strong>: <a class="reference external" href="https://doc.coreboot.org/lib/abi-data-consumption.html">https://doc.coreboot.org/lib/abi-data-consumption.html</a></p>
<p><strong>Reference</strong>:
<a class="reference external" href="https://github.com/tianocore/edk2/blob/master/UefiPayloadPkg/Library/CbParseLib/CbParseLib.c">https://github.com/tianocore/edk2/blob/master/UefiPayloadPkg/Library/CbParseLib/CbParseLib.c</a></p>
<p>Coreboot passes information to downstream users (payloads and/or
operating systems) using <strong>coreboot tables</strong>.</p>
<p>The table usually sits in memory around address 0x500. However, some
bootloaders seem to overwrite low memory area, thus destroying the
coreboot table integrity, rendering the table useless. So, the
coreboot tables were moved to the high tables area.</p>
<p>When coreboot tables were moved to high memory, a 40 bytes mini
coreboot table with a single sub table is placed at 0x500/0x530 that
points to the real coreboot table. This is comparable to the ACPI
RSDT or the MP floating table.</p>
<p>Coreboot tables contain a series of data records packed back to back, with
each encoding both type and size. This is something similar to a UEFI
HOB list. Coreboot tables provide information about:</p>
<ul class="simple">
<li><p><strong>memory map</strong></p></li>
<li><p><strong>Graphics Info</strong></p></li>
<li><p>Pointers to certain CBMEM structures, such as <strong>ACPI, SMBIOS</strong>, etc.</p></li>
</ul>
</div></blockquote>
</section>
<section id="slim-bootloader-sbl-payload-interface">
<h3><span class="section-number">2.7.2. </span>Slim Bootloader (SBL) Payload Interface<a class="headerlink" href="#slim-bootloader-sbl-payload-interface" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><strong>Reference</strong>:
<a class="reference external" href="https://slimbootloader.github.io/developer-guides/payload.html">https://slimbootloader.github.io/developer-guides/payload.html</a></p>
<p><strong>Reference</strong>:
<a class="reference external" href="https://uefi.org/sites/default/files/resources/PI_Spec_1_7_final_Jan_2019.pdf">https://uefi.org/sites/default/files/resources/PI_Spec_1_7_final_Jan_2019.pdf</a></p>
<p><strong>Reference</strong>:
<a class="reference external" href="https://github.com/tianocore/edk2/blob/master/UefiPayloadPkg/Library/SblParseLib/SblParseLib.c">https://github.com/tianocore/edk2/blob/master/UefiPayloadPkg/Library/SblParseLib/SblParseLib.c</a></p>
<p>SBL supports ‘loosely coupled payload’, which basically refers to
payloads built independently (no source sharing). SBL builds a series
of data structures called the Hand Off Blocks (HOBs) and provides a
pointer to this HOB List to the payloads. These data structures
conform to the HOB format as described in the Platform Initialization
(PI) Specification.</p>
</div></blockquote>
</section>
<section id="pei-to-dxe-interface">
<h3><span class="section-number">2.7.3. </span>PEI to DXE Interface<a class="headerlink" href="#pei-to-dxe-interface" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><strong>Reference</strong>:
<a class="reference external" href="https://uefi.org/sites/default/files/resources/PI_Spec_1_7_final_Jan_2019.pdf">https://uefi.org/sites/default/files/resources/PI_Spec_1_7_final_Jan_2019.pdf</a></p>
<p>PEI must also provide a mechanism for components of DXE and the DXE
Foundation to discover the state of the system when the DXE
Foundation is invoked. Some aspects of the system state at handoff
are architectural; others may vary and those must be described to
DXE components.</p>
<p>The DXE IPL PPI passes the Hand-Off Block (HOB) list from PEI to the
DXE Foundation when it invokes the DXE Foundation. The handoff state
is described in the form of HOBs in the HOB list.</p>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Required HOB Type</p></th>
<th class="head"><p>Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Phase Handoff Information Table
(PHIT) HOB</p></td>
<td><p>This HOB is required.</p></td>
</tr>
<tr class="row-odd"><td><p>One or more Resource Descriptor
HOB(s) describing physical
system memory</p></td>
<td><p>The DXE Foundation will use this
physical system memory for DXE.</p></td>
</tr>
<tr class="row-even"><td><p>Boot-strap processor (BSP) Stack
HOB</p></td>
<td><p>The DXE Foundation needs to know
the current stack location so
that it can move it if
necessary, based upon its
desired memory address map. This
HOB will be of type
EfiConventionalMemory</p></td>
</tr>
<tr class="row-odd"><td><p>One or more Resource Descriptor
HOB(s) describing firmware
devices</p></td>
<td><p>The DXE Foundation will place
this into the GCD.</p></td>
</tr>
<tr class="row-even"><td><p>One or more Firmware Volume
HOB(s)</p></td>
<td><p>The DXE Foundation needs this
information to begin loading
other drivers in the platform.</p></td>
</tr>
<tr class="row-odd"><td><p>A Memory Allocation Module HOB</p></td>
<td><p>This HOB tells the DXE
Foundation where it is when
allocating memory into the
initial system address map.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="os-interfaces">
<span id="id7"></span><h2><span class="section-number">2.8. </span>OS interfaces<a class="headerlink" href="#os-interfaces" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>While this specification aims to document the bootloader to payload
interface, the payload to OS interface is briefly discussed just for
the sake of completeness.</p>
</div></blockquote>
<section id="os-boot-protocols">
<h3><span class="section-number">2.8.1. </span>OS Boot protocols<a class="headerlink" href="#os-boot-protocols" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p><strong>UEFI</strong></p>
<p>UEFI stands for “Unified Extensible Firmware Interface.” The UEFI
Specification defines a new model for the interface between
personal-computer operating systems and platform firmware. The
interface consists of data tables that contain platform-related
information, plus boot and runtime service calls that are available
to the operating system and its loader. Together, these provide a
standard environment for booting an operating system and running
pre-boot applications.</p>
<p><a class="reference external" href="https://uefi.org/specifications">https://uefi.org/specifications</a></p>
<p><strong>Linux Boot Protocol</strong></p>
<p>Linux kernel can itself be a bootable image without needing a
separate OS Loader. The Linux boot protocol defines the requirements
required to launch Linux kernel as a boot target.</p>
<p><a class="reference external" href="https://www.kernel.org/doc/html/latest/x86/boot.html">https://www.kernel.org/doc/html/latest/x86/boot.html</a></p>
<p><strong>Multiboot Protocol</strong></p>
<p>The Multiboot specification is an open standard describing how a boot
loader can load an x86 operating system kernel. The specification
allows any compliant bootloader implementation to boot any compliant
operating-system kernel. Thus, it allows different operating systems
and bootloaders to work together and interoperate, without the need
for operating system specific bootloaders.</p>
<p><a class="reference external" href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html">https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html</a></p>
</div></blockquote>
</section>
<section id="data-interface">
<h3><span class="section-number">2.8.2. </span>Data interface<a class="headerlink" href="#data-interface" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Modern computer buses and devices such as PCI, PCIe, USB, and SATA support
software detection, enumeration and configuration, providing true
plug and play capabilities. However, there still exist some devices that are
not enumerable through software.</p>
<p>Examples:</p>
<ul class="simple">
<li><p>PCI Host Bridge</p></li>
<li><p>GPIO</p></li>
<li><p>Serial interfaces like I2C, HS-UART, etc.</p></li>
<li><p>Graphics framebuffer</p></li>
<li><p>Device Management information including manufacturer name, etc.</p></li>
</ul>
<p>While it is possible to write platform specific device drivers to
support such devices/interfaces, it is efficient for the platform
specific firmware to provide information to the platform independent
operating system.</p>
<p>There are two data protocols that are used extensively for this
purpose: ACPI and devicetree.</p>
<p><strong>ACPI</strong></p>
<p>Advanced Configuration and Power Interface (<strong>ACPI</strong>) provides an
open standard that operating systems can use to discover and
configure computer hardware components and to perform power management
and status monitoring. In October 2013, ACPI Special Interest Group
(ACPI SIG), the original developers of the ACPI standard, agreed to
transfer all assets to the UEFI Forum, in which all future development
will take place.</p>
<p><strong>SMBIOS</strong></p>
<p>System Management BIOS (<strong>SMBIOS</strong>) is the premier standard for
delivering management information via system firmware.</p>
<p><a class="reference external" href="https://uefi.org/specifications">https://uefi.org/specifications</a></p>
<p><a class="reference external" href="https://www.dmtf.org/standards/smbios">https://www.dmtf.org/standards/smbios</a></p>
<p><strong>Devicetree</strong></p>
<p>The devicetree is a data structure for describing hardware. A
devicetree is a tree data structure with nodes that describe the
devices in a system. Each node has property/value pairs that describe
the characteristics of the device being represented.</p>
<p><a class="reference external" href="https://www.devicetree.org/">https://www.devicetree.org/</a></p>
</div></blockquote>
</section>
</section>
<section id="payload-principle">
<h2><span class="section-number">2.9. </span>Payload principle<a class="headerlink" href="#payload-principle" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><div class="line-block">
<div class="line">Keep interface as clean and simple as possible.</div>
<div class="line">The payload should encapsulate the boot abstractions for a given
technology, such as UEFI payload or LinuxBoot. The Payload should
vie to be portable to different platform implementations (PI), such
as coreboot, Slim bootloader, or an EDKII style firmware.</div>
<div class="line">The payload should elide strong dependencies on the payload
launching code (e.g., coreboot versus EDKII versus Slim Bootloader) and
also avoid board-specific dependencies. The payload behavior should
be parameterized by the data input block.</div>
</div>
<div class="line-block">
<div class="line"><strong>Open</strong><em>: Should Payload return back to bootloader if payload
fail?</em></div>
<div class="line"><em>Answer: No for first generation. No callbacks into payload
launcher.</em></div>
</div>
<p><strong>Open</strong><em>: Do we need callback from payload to bootloader? Avoid it
if possible</em></p>
<div class="line-block">
<div class="line"><strong>Open</strong><em>: How to support SMM for booloader and Payload? Where is
trust boundary.</em></div>
<div class="line"><em>Answer: SMM should be either part of the payload for present
generation Management Mode (MM) PI drivers, but longer term the
EDKII PI independent MM modules should be used. The latter are a
class of SMM drivers (or TrustZone drivers for ARM) that are not
launched via DXE. For coreboot SMM can be loaded from ramstage, the
PI payload launcher, or elided from ramstage and use the portable
MM handlers.</em></div>
<div class="line">If there is an existing standard it will be used (e.g., ACPI table
that is simple to parse).</div>
</div>
</div></blockquote>
</section>
<section id="payload-security">
<h2><span class="section-number">2.10. </span>Payload Security<a class="headerlink" href="#payload-security" title="Permalink to this heading">¶</a></h2>
<p>Payload is part of system firmware TCB</p>
<blockquote>
<div><p>Today the payload is provisioned as part of the platform
initialization code. As such, the payload is protected and updated by
the platform manufacturer (PM). The payload should be covered by a
digital signature generated by the PM. The platform owner (PO) should
not be able to update the payload independently of the PM.</p>
<div class="line-block">
<div class="line">The platform initialization (PI) code should be the platform root
of trust for update, measurement, and verification. As such, the PI
code that launches the payload should verify the payload using
payload Hash or using a key to verify its signature. The PI code
should also provide a measurement into a Trusted Platform Module
(TPM) of the payload into a TPM Platform Configuration Register
(e.g., PCR[0]). The payload may continue the measured boot actions
by recording code executed in the payload phase into PCRs (e.g.,
UEFI driver into PCR[2], UEFI OS loader into PCR[4]).</div>
<div class="line"><em>Open: Do we need a capability boot to say if payload
supports/requires measured/verified boot?</em></div>
</div>
</div></blockquote>
</section>
<section id="payload-image-format">
<h2><span class="section-number">2.11. </span>Payload Image Format<a class="headerlink" href="#payload-image-format" title="Permalink to this heading">¶</a></h2>
<p>Payload, as a standalone component, usually needs to be loaded by a
bootloader into memory properly prior to execution. In this loading
process, additional process might be required, such as assembling,
rebasing, authenticating, etc. Today, many payloads use
their own image formats (PE, ELF, FV, RAW, etc.), and it is very
challenging for a bootloader to identify and support all of them.</p>
<p>To address this, a common payload image format is desired to
facilitate the payload loading process. Instead of defining a new
image format for payloads, it is preferred to reuse an already-existing
format, such as ELF (Executable and Linkable Format) and PE (Portable
Executable). This specification selects the ELF image format as the
common universal payload image format, since it is flexible, extensible,
and cross-platform. It is also adopted by many different operating systems
on many different hardware platforms.</p>
<p>For detailed information on the ELF image format, please see
<a class="reference external" href="https://refspecs.linuxfoundation.org/elf/elf.pdf">ELF Specification</a> .</p>
<section id="payload-image-sections">
<h3><span class="section-number">2.11.1. </span>Payload Image Sections<a class="headerlink" href="#payload-image-sections" title="Permalink to this heading">¶</a></h3>
<p>To use ELF image as universal payload image format, it is required to define
a simple way for bootloader to differentiate a universal payload image from
a regular ELF image. On the other side, a universal payload might also need
additional image information to proceed with the boot flow. This specification
requires the universal payload image to provide these additional required
information through new defined ELF sections, <em>Universal Payload Information
Section</em>, and <em>Universal Payload Loaded Image Section</em>.</p>
</section>
<section id="universal-payload-information-section">
<h3><span class="section-number">2.11.2. </span>Universal Payload Information Section<a class="headerlink" href="#universal-payload-information-section" title="Permalink to this heading">¶</a></h3>
<p>This specification requires a mandatory ELF universal payload information section
to indicate the ELF image conforms to this specification. If this section is found
inside the ELF image and is valid, the bootloader can retrieve universal payload
specific information from this section, such as payload version, payload ID, etc.
And the bootloader shall use the interfaces defined in this specification to handoff
the control to the payload.</p>
<p>This Universal Payload Information section must:</p>
<ul class="simple">
<li><p>Have section name defined as “.upld_info”</p></li>
<li><p>Have section aligned at 4-byte boundary within the ELF image.</p></li>
<li><p>Contain UNIVERSAL_PAYLOAD_INFO structure in its section, as
defined as below:</p></li>
</ul>
<p><strong>UNIVERSAL_PAYLOAD_INFO Structure</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Byte Offset</p></th>
<th class="head"><p>Size in Bytes</p></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>4</p></td>
<td><p>Identifier</p></td>
<td><p>‘PLDH’
Identifier for
the unverial
payload info.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>4</p></td>
<td><p>HeaderLength</p></td>
<td><p>Length of the
structure in
bytes.</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>2</p></td>
<td><p>SpecRevision</p></td>
<td><p>Indicates
compliance with
a revision of
this
specification
in the BCD
format.</p>
<p>7 : 0 - Minor
Version</p>
<p>15 : 8 - Major
Version</p>
<p>For revision
v0.90, the value
will be 0x0090.</p>
</td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>2</p></td>
<td><p>Reserved</p></td>
<td><p>Reserved for
future use.</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>4</p></td>
<td><p>Revision</p></td>
<td><p>Revision of the
Payload
binary.
Major.Minor
.Revision.Build</p>
<p>The
ImageRevision
can be decoded
as follows:</p>
<p> 7 : 0  - Build
Number</p>
<p>15 :8  -
Revision</p>
<p>23 :16 - Minor
Version</p>
<p>31 :24 - Major
Version</p>
</td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p>4</p></td>
<td><p>Attribute</p></td>
<td><p>Bit-field
attribute
indicator of
the payload
image.</p>
<p>BIT 0: Build
Type.</p>
<p>0: Release Build</p>
<p>1: Debug Build</p>
</td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p>4</p></td>
<td><p>Capability</p></td>
<td><p>Bit-field
capability
indicator that
the payload
image can
support.</p>
<p>BIT 0: Support
SMM rebase</p>
</td>
</tr>
<tr class="row-odd"><td><p>24</p></td>
<td><p>16</p></td>
<td><p>ProducerId</p></td>
<td><p>A
null-terminated
OEM-supplied
string that
identifies the
payload
producer.</p></td>
</tr>
<tr class="row-even"><td><p>40</p></td>
<td><p>16</p></td>
<td><p>ImageId</p></td>
<td><p>A
null-terminated
ASCII string
that identifies
the payload
name.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="universal-payload-loaded-image-section">
<h3><span class="section-number">2.11.3. </span>Universal Payload Loaded Image Section<a class="headerlink" href="#universal-payload-loaded-image-section" title="Permalink to this heading">¶</a></h3>
<p>There are many cases that a payload might need extra images to proceed the
boot flow. For example, UEFI payload might need additional FV images, Linux
payload might need additional InitRd image, u-boot might need additional
devicetree blob, etc. In these cases, it is desired to pass this additional
image information from bootloader to payload so that payload can consume these
images later.</p>
<p>This specification defines optional universal payload extra image sections.
If they exist, they hold extra image information to be passed into the universal
payload. Please note, multiple extra image sections might exist in single
universal payload ELF image.</p>
<p>If a universal payload extra image section needs to be provided, it must:</p>
<ul class="simple">
<li><p>Have unique section name defined as “.upld.*”. The full section name string
length needs to be less than 16. Here, ‘*’ can be any ASCII string.</p></li>
<li><p>Have section aligned at proper boundary within the ELF file as required by
the nature of the extra image itself. For example, FV and InitRd might need
4KB page-aligned.</p></li>
<li><p>Contain the raw extra image data in its section.</p></li>
</ul>
<p>During payload image loading, the bootloader shall build these extra images into
HOB. And the universal payload can locate the information from the HOB and find
required extra image information for consumption.</p>
</section>
</section>
<section id="hand-off-state">
<h2><span class="section-number">2.12. </span>Hand-off state<a class="headerlink" href="#hand-off-state" title="Permalink to this heading">¶</a></h2>
<p>The bootloader builds the Hand-Off Block (HOB) list containing
platform specific information and passes the address of the HOB list
to the payload.</p>
<p>The prototype of payload entry point is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span>
<span class="n">VOID</span>
<span class="p">(</span><span class="o">*</span><span class="n">PAYLOAD_ENTRY</span><span class="p">)</span> <span class="p">(</span>
  <span class="n">EFI_HOB_HANDOFF_INFO_TABLE</span> <span class="o">*</span><span class="n">HobList</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The compiler need use a proper attributes for this function to meet the calling convention below.
For example, Microsoft Visual studio uses __cdecl for X64, while Linux GCC uses __attribute__((ms_abi)) for X64.</p>
<p>HOB List defines the detailed HOB list being used to transfer
platform specific data from the bootloader to the payload.</p>
<section id="ia-32-and-x64-platforms">
<h3><span class="section-number">2.12.1. </span>IA-32 and x64 Platforms<a class="headerlink" href="#ia-32-and-x64-platforms" title="Permalink to this heading">¶</a></h3>
<section id="state-of-silicon">
<h4><span class="section-number">2.12.1.1. </span>State of silicon<a class="headerlink" href="#state-of-silicon" title="Permalink to this heading">¶</a></h4>
<blockquote>
<div><p>The bootloader initializes the processor and chipset through
vendor-specific silicon initialization implementation. For example,
FSP is a binary form of Intel silicon initialization implementation.
Typically, when the control transfers to the payload:</p>
</div></blockquote>
<ul class="simple">
<li><p>The memory controller is initialized such that physical memory is
available to use.</p></li>
<li><p>Processors (including application processors) are patched with
microcode and initialized properly.</p></li>
<li><p>The PCI bus is assigned with proper bus numbers, IO/MMIO space.</p></li>
<li><p>The Graphics controller may be initialized properly.</p></li>
</ul>
<blockquote>
<div><p>But the bootloader could do less silicon initialization if the
responsibilities of the payload and the bootloader are well defined
(out of the scope of this document).</p>
</div></blockquote>
</section>
<section id="instruction-execution-environment">
<h4><span class="section-number">2.12.1.2. </span>Instruction execution environment<a class="headerlink" href="#instruction-execution-environment" title="Permalink to this heading">¶</a></h4>
<blockquote>
<div><p>Regardless of the environment where the bootloader runs, the processor
is in 32-bit protected mode when a 32-bit payload starts, or in 64-bit
long-mode when a 64-bit payload starts. The payload header contains
the machine type information that the payload supports.</p>
<p>The following sections provide a detailed description of the
execution environment when the payload starts.</p>
</div></blockquote>
<section id="registers">
<h5><span class="section-number">2.12.1.2.1. </span>Registers<a class="headerlink" href="#registers" title="Permalink to this heading">¶</a></h5>
<ul>
<li><p>ESP + 4 points to the address of the HOB list for the 32-bit payload.</p></li>
<li><p>RCX holds the address of the HOB list for the 64-bit payload.</p></li>
<li><p>Direction flag in EFLAGs is clear so the string instructions process
from low addresses to high addresses.</p></li>
<li><p>All other general-purpose register states are undefined.</p></li>
<li><p>Floating-point control word is initialized to 0x027F (all exceptions
masked, double-precision, round-to-nearest).</p></li>
<li><div class="line-block">
<div class="line">Multimedia-extensions control word (if supported) is initialized to
0x1F80 (all exceptions</div>
<div class="line">masked, round-to-nearest, flush to zero for masked underflow).</div>
</div>
</li>
<li><p>CR0.EM is clear.</p></li>
<li><p>CR0.TS is clear.</p></li>
</ul>
</section>
<section id="interrupt">
<h5><span class="section-number">2.12.1.2.2. </span>Interrupt<a class="headerlink" href="#interrupt" title="Permalink to this heading">¶</a></h5>
<blockquote>
<div><p>Interrupt is disabled. The hardware is initialized by the bootloader
such that no interrupt triggers even when the payload sets the
Interrupt Enable flag in EFLAGs.</p>
</div></blockquote>
</section>
<section id="page-table">
<h5><span class="section-number">2.12.1.2.3. </span>Page table<a class="headerlink" href="#page-table" title="Permalink to this heading">¶</a></h5>
<blockquote>
<div><p>Selectors are set to be flat.</p>
<p>Paging mode may be enabled for the 32-bit payload. (have general term
on how it could be enabled if enabling page mode).</p>
<p>Paging mode is enabled for the 64-bit payload.</p>
<p>When paging is enabled, all memory space is identity mapped (virtual
address equals physical address). The four-level page table is set
up. The payload can choose to set up the five-level page table as
needed.</p>
</div></blockquote>
</section>
<section id="stack">
<h5><span class="section-number">2.12.1.2.4. </span>Stack<a class="headerlink" href="#stack" title="Permalink to this heading">¶</a></h5>
<blockquote>
<div><p>4KiB stack is available for the payload. The stack is 16-byte aligned
and may be marked as non-executable in page table.</p>
<p>discussion: Should payload declare its required stack size in the
payload header?</p>
<p>Payload could setup its own stack, there is no restriction to setup a
new stack.</p>
</div></blockquote>
</section>
<section id="application-processors">
<h5><span class="section-number">2.12.1.2.5. </span>Application processors<a class="headerlink" href="#application-processors" title="Permalink to this heading">¶</a></h5>
<blockquote>
<div><p>Payload starts on the bootstrap processor. All application processors
(on a multiple-processor system) are in halt state.</p>
<p>Use mWait and mBox to wake up. (Follow ACPI table). How about the
legacy bootloader? Assume something if ACPI is not there.</p>
<p>TODO: take care about virtual platforms.</p>
</div></blockquote>
</section>
</section>
</section>
<section id="arm-platforms">
<h3><span class="section-number">2.12.2. </span>ARM Platforms<a class="headerlink" href="#arm-platforms" title="Permalink to this heading">¶</a></h3>
<p>Need community inputs</p>
</section>
<section id="risc-v-platforms">
<h3><span class="section-number">2.12.3. </span>RISC-V Platforms<a class="headerlink" href="#risc-v-platforms" title="Permalink to this heading">¶</a></h3>
<p>Need community inputs</p>
</section>
</section>
<section id="payload-interfaces">
<h2><span class="section-number">2.13. </span>Payload Interfaces<a class="headerlink" href="#payload-interfaces" title="Permalink to this heading">¶</a></h2>
<p>The bootloader provides platform information to payload through
standard ACPI table, SMBIOS table, Devicetree and a series of data
structures called the Hand Off Blocks (HOBs). If the information is
already defined in the ACPI specification, SMBIOS specification or
devicetree, the payload could parse them to get the required information.
For the platform information that is not defined in the standard
tables, the bootloader should build a HOB list to pass it to the
payload.</p>
<p>Open: Do we need a set of configuration data to config payload?</p>
<blockquote>
<div><p>We do not believe so.</p>
</div></blockquote>
<p>Open: Do we need pass data from payload to bootloader to impact bootloader behavior in next boot?</p>
<blockquote>
<div><p>Keep it open now.</p>
</div></blockquote>
<p>Open: will payload be run in S3 path?</p>
<blockquote>
<div><p>Suggest skipping payload.</p>
</div></blockquote>
<section id="acpi-tables">
<span id="id8"></span><h3><span class="section-number">2.13.1. </span>ACPI tables<a class="headerlink" href="#acpi-tables" title="Permalink to this heading">¶</a></h3>
<p>ACPI table is required to boot modern operation system, especially
to boot windows operating system. The bootloader should provide an
ACPI RSDP HOB. In the ACPI table least RSDT, FADT and MCFG should
be available to the payload.Payload could remove/add/modify the
ACPI table passed from the bootloader if required.</p>
<p>The payload could parse the ACPI table to get some basic platform
information. For example, the Fixed ACPI Description Table (FADT)
defines various fixed hardware ACPI information to an ACPI compatible
OS, such as the base address for the following hardware registers
blocks: PM1a_CNT_BLK, PM_TMR_BLK, PM1a_EVT_BLK, GPE0_BLK,
PM1b_EVT_BLK, PM1b_CNT_BLK, PM2_CNT_BLK, and GPE1_BLK. The payload
could use them and other values (e.g. RESET_REG, RESET_VALUE) to make
the payload platform independent.</p>
<p>The other example is to get the PCIE base address from ACPI memory mapped
configuration space access table definition, defined in the PCI
Firmware Specification.
<cite>http://www.pcisig.com &lt;http://www.pcisig.com/&gt;</cite>.</p>
<p>And another example is on the debug device info. The bootloader might
report debug device following up ACPI Debug Port Table 2 (DBG2). If a
fully 16550-compatible serial device is specified in the ACPI DBG2,
bootloader should provide a Serial Debug Information HOB in the HOB
list so that the payload could use same debug device with same
setting. If the ACPI DBG2 table could not be found, the payload
should use serial device provided by the Serial Debug Information HOB
as the default debug device.</p>
</section>
<section id="hob-list">
<h3><span class="section-number">2.13.2. </span>HOB List<a class="headerlink" href="#hob-list" title="Permalink to this heading">¶</a></h3>
<p>The bootloader should build a HOB list and pass the HOB list header
to payload when passing control to payload. The HOB format is
described in the <em>Platform Initialization (PI) Specification - Volume
3: Shared Architectural Elements</em>.</p>
<p>There are two sections below describing the HOBs produced by the
bootloader and consumed by the payload for providing the system
architecturally information.</p>
<p>First section describes the HOBs defined in <em>Platform Initialization
Specification Volume 3: Shared Architectural elements</em>.</p>
<p>Second section defines the new HOBs.</p>
<section id="reusing-interfaces-in-platform-initialization-specification">
<h4><span class="section-number">2.13.2.1. </span>Reusing Interfaces in Platform Initialization Specification<a class="headerlink" href="#reusing-interfaces-in-platform-initialization-specification" title="Permalink to this heading">¶</a></h4>
<section id="phit-phase-handoff-info-table-hob">
<h5><span class="section-number">2.13.2.1.1. </span>PHIT(Phase Handoff Info Table) HOB<a class="headerlink" href="#phit-phase-handoff-info-table-hob" title="Permalink to this heading">¶</a></h5>
<p>The bootloader should report the general state information through
the HOB following EFI_HOB_HANDOFF_INFO_TABLE format defined in
<em>Platform Initialization Specification Volume 3: Shared Architectural
elements</em>.</p>
</section>
<section id="cpu-hob">
<h5><span class="section-number">2.13.2.1.2. </span>CPU HOB<a class="headerlink" href="#cpu-hob" title="Permalink to this heading">¶</a></h5>
<p>The bootloader should report the processor information including address space
and I/O space capabilities to the payload through the HOB following
EFI_HOB_CPU format defined in <em>Platform Initialization Specification Volume 3:
Shared Architectural elements</em>.</p>
</section>
<section id="resource-descriptor-hob">
<h5><span class="section-number">2.13.2.1.3. </span>Resource Descriptor HOB<a class="headerlink" href="#resource-descriptor-hob" title="Permalink to this heading">¶</a></h5>
<p>The bootloader should report the system resources through the HOB
following EFI_HOB_RESOURCE_DESCRIPTOR format defined in <em>Platform
Initialization Specification Volume 3: Shared Architectural
elements</em>.</p>
<p>For example, any physical memory found in bootloader should be
reported using resource type EFI_RESOURCE_SYSTEM_MEMORY, and the
reserved memory used by bootloader should be reported using resource
type EFI_RESOURCE_MEMORY_RESERVED.</p>
<p>I/O and memory mapped I/O resource should also be reported using
resource type EFI_RESOURCE_IO and EFI_RESOURCE_MEMORY_MAPPED_IO.</p>
</section>
<section id="memory-allocation-hob">
<h5><span class="section-number">2.13.2.1.4. </span>Memory Allocation HOB<a class="headerlink" href="#memory-allocation-hob" title="Permalink to this heading">¶</a></h5>
<p>The bootloader should report the memory usages that exist outside the
HOB list through the HOB following EFI_HOB_MEMORY_ALLOCATION format defined
in <em>Platform Initialization Specification Volume 3: Shared Architectural
elements</em>.</p>
<section id="boot-strap-processor-bsp-stack-memory-allocation-hob">
<h6><span class="section-number">2.13.2.1.4.1. </span>Boot-Strap Processor (BSP) Stack Memory Allocation HOB<a class="headerlink" href="#boot-strap-processor-bsp-stack-memory-allocation-hob" title="Permalink to this heading">¶</a></h6>
<p>The bootloader should report the initial stack prepared for payload through
the HOB following EFI_HOB_MEMORY_ALLOCATION_STACK format defined in <em>Platform
Initialization Specification Volume 3: Shared Architectural elements</em>.</p>
</section>
<section id="memory-allocation-module-hob">
<h6><span class="section-number">2.13.2.1.4.2. </span>Memory Allocation Module HOB<a class="headerlink" href="#memory-allocation-module-hob" title="Permalink to this heading">¶</a></h6>
<p>The bootloader should report the payload memory location and entry point
through the HOB following EFI_HOB_MEMORY_ALLOCATION_MODULE format defined
in <em>Platform Initialization Specification Volume 3: Shared Architectural
elements</em>.</p>
</section>
</section>
<section id="graphics-information-hob">
<h5><span class="section-number">2.13.2.1.5. </span>Graphics information HOB<a class="headerlink" href="#graphics-information-hob" title="Permalink to this heading">¶</a></h5>
<p>If bootloader initializes the graphics device, the bootloader might
report graphics mode and framebuffer information through
EFI_PEI_GRAPHICS_INFO_HOB, and graphics hardware information
through EFI_PEI_GRAPHICS_DEVICE_INFO_HOB.</p>
<p>EFI_PEI_GRAPHICS_INFO_HOB and EFI_PEI_GRAPHICS_DEVICE_INFO_HOB provide the basic information
for the graphics display. These HOBs are described in the <em>PI Specification.</em></p>
<p>Please refer to Appendix 6.6 EFI_PEI_GRAPHICS_INFO_HOB and 6.7 EFI_PEI_GRAPHICS_DEVICE_INFO_HOB for the details.</p>
</section>
</section>
<section id="new-interfaces">
<h4><span class="section-number">2.13.2.2. </span>New Interfaces<a class="headerlink" href="#new-interfaces" title="Permalink to this heading">¶</a></h4>
<section id="common-payload-header">
<h5><span class="section-number">2.13.2.2.1. </span>Common Payload Header<a class="headerlink" href="#common-payload-header" title="Permalink to this heading">¶</a></h5>
<p>All new interfaces are GUID type HOBs starting with <code class="docutils literal notranslate"><span class="pre">EFI_HOB_GUID_TYPE</span></code> defined in the PI Specification.</p>
<p>The HOB data starts with a common header defined as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack(1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT8</span>                <span class="n">Revision</span><span class="p">;</span>
  <span class="n">UINT8</span>                <span class="n">Reserved</span><span class="p">;</span>
  <span class="n">UINT16</span>               <span class="n">Length</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Revision</span></code></p>
<p>It doesn’t increase when new members are appended to the end of the interface.</p>
<p>It increases by one when existing members are renamed or re-interpreted for different purposes.</p>
<p><code class="docutils literal notranslate"><span class="pre">Length</span></code></p>
<p>The Length equals to the sizeof (UNIVERSAL_PAYLOAD_GENERIC_HEADER) + sizeof (&lt;additional members&gt;).</p>
<p>Consumers of the interfaces should only access those members that are covered by Length.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">EFI_HOB_GUID_TYPE</span></code> contains a Length field to tell the actual bytes the whole HOB data occupies.</p>
<p>It also includes the optional padding bytes to make sure each HOB is multiple of 8 bytes in length.</p>
<p><code class="docutils literal notranslate"><span class="pre">UNIVERSAL_PAYLOAD_GENERIC_HEADER.Length</span></code> tells the exact length of the meaningful data excluding the padding bytes.
So, it’s always true that <code class="docutils literal notranslate"><span class="pre">UNIVERSAL_PAYLOAD_GENERIC_HEADER.Length</span></code> is less than or equal to the Length in <code class="docutils literal notranslate"><span class="pre">EFI_HOB_GUID_TYPE</span></code>.</p>
</div>
<p>HOB data for different interfaces is defined in following sections.</p>
</section>
<section id="acpi-table">
<h5><span class="section-number">2.13.2.2.2. </span>ACPI Table<a class="headerlink" href="#acpi-table" title="Permalink to this heading">¶</a></h5>
<p>The bootloader should pass ACPI table the payload. So that the payload could get the platform information from the ACPI table.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadAcpiTableGuid</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x9f9a9506</span><span class="p">,</span> <span class="mh">0x5597</span><span class="p">,</span> <span class="mh">0x4515</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xe7</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x87</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack (1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>             <span class="n">Rsdp</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_ACPI_TABLE</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 12.</p>
<p><code class="docutils literal notranslate"><span class="pre">Rsdp</span></code></p>
<p>Points to the ACPI RSDP table. The ACPI table need to follow ACPI specification version 2.0 or above.</p>
</section>
<section id="smbios-table">
<h5><span class="section-number">2.13.2.2.3. </span>SMBIOS Table<a class="headerlink" href="#smbios-table" title="Permalink to this heading">¶</a></h5>
<p>The bootloader might pass SMBIOS table to the payload. So that the payload could get the platform information from the table.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadSmbios3TableGuid</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x92b7896c</span><span class="p">,</span> <span class="mh">0x3362</span><span class="p">,</span> <span class="mh">0x46ce</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span> <span class="mh">0x42</span> <span class="p">}</span> <span class="p">}</span>

<span class="n">gUniversalPayloadSmbiosTableGuid</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x590a0d26</span><span class="p">,</span> <span class="mh">0x06e5</span><span class="p">,</span> <span class="mh">0x4d20</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x2d</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack (1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>             <span class="n">SmBiosEntryPoint</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_SMBIOS_TABLE</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 12.</p>
<p><code class="docutils literal notranslate"><span class="pre">SmBiosEntryPoint</span></code></p>
<p>Points to the SMBIOS table in SMBIOS 3.0+ format if GUID is <code class="docutils literal notranslate"><span class="pre">gUniversalPayloadSmbios3TableGuid</span></code>.</p>
<p>Points to the SMBIOS table in SMBIOS 2.x format if GUID is <code class="docutils literal notranslate"><span class="pre">gUniversalPayloadSmbiosTableGuid</span></code>.</p>
</section>
<section id="devicetree">
<h5><span class="section-number">2.13.2.2.4. </span>Devicetree<a class="headerlink" href="#devicetree" title="Permalink to this heading">¶</a></h5>
<p>The bootloader might pass devicetree to the payload. So that the payload could get the platform information from the table.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadDeviceTreeGuid</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x6784b889</span><span class="p">,</span> <span class="mh">0xb13c</span><span class="p">,</span> <span class="mh">0x4c3b</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">}}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack (1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>             <span class="n">DeviceTreeAddress</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_DEVICE_TREE</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 12.</p>
<p><code class="docutils literal notranslate"><span class="pre">DeviceTreeAddress</span></code></p>
<p>Points to the devicetree entry point.</p>
</section>
<section id="serial-information">
<h5><span class="section-number">2.13.2.2.5. </span>Serial Information<a class="headerlink" href="#serial-information" title="Permalink to this heading">¶</a></h5>
<p>If the debug device type and subtype are specified in DBG2, the
bootloader should 16550 compatible serial debug port information
to payload.</p>
<p><strong>Opens: Should we let bootloader provide debug callback</strong> <strong>for debug?</strong></p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadSerialPortInfoGuid</span>   <span class="o">=</span> <span class="p">{</span><span class="mh">0xaa7e190d</span><span class="p">,</span> <span class="mh">0xbe21</span><span class="p">,</span> <span class="mh">0x4409</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">}}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack(1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>                          <span class="n">UseMmio</span><span class="p">;</span>
  <span class="n">UINT8</span>                            <span class="n">RegisterStride</span><span class="p">;</span>
  <span class="n">UINT32</span>                           <span class="n">BaudRate</span><span class="p">;</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>             <span class="n">RegisterBase</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_SERIAL_PORT_INFO</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 18.</p>
<p><code class="docutils literal notranslate"><span class="pre">UseMmio</span></code></p>
<p>Indicates the 16550 serial port registers are in MMIO space, or in I/O space.</p>
<p><code class="docutils literal notranslate"><span class="pre">RegisterStride</span></code></p>
<p>Indicates the number of bytes between registers.</p>
<p><code class="docutils literal notranslate"><span class="pre">BaudRate</span></code></p>
<p>Baud rate for the 16550 compatible serial port.</p>
<p>It could be 921600, 460800, 230400, 115200, 57600, 38400, 19200,
9600, 7200, 4800, 3600, 2400, 2000, 1800, 1200, 600, 300, 150, 134,
110, 75, 50</p>
<p>Set to 0 to use the default baud rate 115200.</p>
<p><code class="docutils literal notranslate"><span class="pre">RegisterBase</span></code></p>
<p>Base address of 16550 serial port registers in MMIO or I/O space.</p>
</section>
<section id="pci-root-bridges">
<h5><span class="section-number">2.13.2.2.6. </span>PCI Root Bridges<a class="headerlink" href="#pci-root-bridges" title="Permalink to this heading">¶</a></h5>
<p>The bootloader should pass information about PCI root bridges to the payload. The information tells the payload whether the PCI bus
enumeration has been performed by the bootloader, the bus, IO and MMIO ranges that are used or will be used by the PCI bus.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadPciRootBridgeInfoGuid</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xec4ebacb</span><span class="p">,</span> <span class="mh">0x2638</span><span class="p">,</span> <span class="mh">0x416e</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">}}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack(1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span>  <span class="n">Header</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>                           <span class="n">ResourceAssigned</span><span class="p">;</span>
  <span class="n">UINT8</span>                             <span class="n">Count</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE</span> <span class="n">RootBridge</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGES</span><span class="p">;</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT32</span>                                     <span class="n">Segment</span><span class="p">;</span>
  <span class="n">UINT64</span>                                     <span class="n">Supports</span><span class="p">;</span>
  <span class="n">UINT64</span>                                     <span class="n">Attributes</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>                                    <span class="n">DmaAbove4G</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>                                    <span class="n">NoExtendedConfigSpace</span><span class="p">;</span>
  <span class="n">UINT64</span>                                     <span class="n">AllocationAttributes</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">Bus</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">Io</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">Mem</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">MemAbove4G</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">PMem</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">PMemAbove4G</span><span class="p">;</span>
  <span class="n">UINT32</span>                                     <span class="n">HID</span><span class="p">;</span>
  <span class="n">UINT32</span>                                     <span class="n">UID</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE</span><span class="p">;</span>

<span class="o">//</span>
<span class="o">//</span> <span class="p">(</span><span class="n">Base</span> <span class="o">&gt;</span> <span class="n">Limit</span><span class="p">)</span> <span class="n">indicates</span> <span class="n">an</span> <span class="n">aperture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">available</span><span class="o">.</span>
<span class="o">//</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">Base</span> <span class="ow">and</span> <span class="n">Limit</span> <span class="n">are</span> <span class="n">the</span> <span class="n">device</span> <span class="n">address</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">host</span> <span class="n">address</span> <span class="n">when</span>
  <span class="o">//</span> <span class="n">Translation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">zero</span>
  <span class="o">//</span>
  <span class="n">UINT64</span> <span class="n">Base</span><span class="p">;</span>
  <span class="n">UINT64</span> <span class="n">Limit</span><span class="p">;</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">According</span> <span class="n">to</span> <span class="n">UEFI</span> <span class="mf">2.7</span><span class="p">,</span> <span class="n">Device</span> <span class="n">Address</span> <span class="o">=</span> <span class="n">Host</span> <span class="n">Address</span> <span class="o">+</span> <span class="n">Translation</span><span class="p">,</span>
  <span class="o">//</span> <span class="n">so</span> <span class="n">Translation</span> <span class="o">=</span> <span class="n">Device</span> <span class="n">Address</span> <span class="o">-</span> <span class="n">Host</span> <span class="n">Address</span><span class="o">.</span>
  <span class="o">//</span> <span class="n">On</span> <span class="n">platforms</span> <span class="n">where</span> <span class="n">Translation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">zero</span><span class="p">,</span> <span class="n">the</span> <span class="n">subtraction</span> <span class="ow">is</span> <span class="n">probably</span> <span class="n">to</span>
  <span class="o">//</span> <span class="n">be</span> <span class="n">performed</span> <span class="k">with</span> <span class="n">UINT64</span> <span class="n">wrap</span><span class="o">-</span><span class="n">around</span> <span class="n">semantics</span><span class="p">,</span> <span class="k">for</span> <span class="n">we</span> <span class="n">may</span> <span class="n">translate</span> <span class="n">an</span>
  <span class="o">//</span> <span class="n">above</span><span class="o">-</span><span class="mi">4</span><span class="n">G</span> <span class="n">host</span> <span class="n">address</span> <span class="n">into</span> <span class="n">a</span> <span class="n">below</span><span class="o">-</span><span class="mi">4</span><span class="n">G</span> <span class="n">device</span> <span class="n">address</span> <span class="k">for</span> <span class="n">legacy</span> <span class="n">PCIe</span> <span class="n">device</span>
  <span class="o">//</span> <span class="n">compatibility</span><span class="o">.</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">The</span> <span class="n">alignment</span> <span class="n">of</span> <span class="n">Translation</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">to</span> <span class="n">be</span> <span class="n">larger</span> <span class="n">than</span> <span class="nb">any</span> <span class="n">BAR</span>
  <span class="o">//</span> <span class="n">alignment</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">root</span> <span class="n">bridge</span><span class="p">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">same</span> <span class="n">alignment</span> <span class="n">can</span> <span class="n">be</span>
  <span class="o">//</span> <span class="n">applied</span> <span class="n">to</span> <span class="n">both</span> <span class="n">device</span> <span class="n">address</span> <span class="ow">and</span> <span class="n">host</span> <span class="n">address</span><span class="p">,</span> <span class="n">which</span> <span class="n">simplifies</span> <span class="n">the</span>
  <span class="o">//</span> <span class="n">situation</span> <span class="ow">and</span> <span class="n">makes</span> <span class="n">the</span> <span class="n">current</span> <span class="n">resource</span> <span class="n">allocation</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">generic</span> <span class="n">PCI</span>
  <span class="o">//</span> <span class="n">host</span> <span class="n">bridge</span> <span class="n">driver</span> <span class="n">still</span> <span class="n">work</span><span class="o">.</span>
  <span class="o">//</span>
  <span class="n">UINT64</span> <span class="n">Translation</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span><span class="p">;</span>
<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 6 + <code class="docutils literal notranslate"><span class="pre">Count</span></code> * sizeof (UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE).</p>
<p><code class="docutils literal notranslate"><span class="pre">ResourceAssigned</span></code></p>
<p>Bus/IO/MMIO resources for all root bridges have been assigned when it’s TRUE.</p>
<p><code class="docutils literal notranslate"><span class="pre">Count</span></code></p>
<p>Count of root bridges. Number of elements in <code class="docutils literal notranslate"><span class="pre">RootBridge</span></code> array.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Segment</span></code></p>
<p>Segment number of the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Supports</span></code></p>
<p>Supported attributes. Refer to EFI_PCI_ATTRIBUTE_xxx used by GetAttributes() and SetAttributes() in EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL
defined in PI Specification.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Attributes</span></code></p>
<p>Initial attributes. Refer to EFI_PCI_ATTRIBUTE_xxx used by GetAttributes() and SetAttributes() in EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL
defined in PI Specification.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].DmaAbove4G</span></code></p>
<p>Root bridge supports DMA above 4GB memory when it’s TRUE.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].NoExtendedConfigSpace</span></code></p>
<p>Root bridge supports 256-byte configuration space only when it’s TRUE.
Root bridge supports 4K-byte configuration space when it’s FALSE.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].AllocationAttributes</span></code></p>
<p>Allocation attributes. Refer to EFI_PCI_HOST_BRIDGE_COMBINE_MEM_PMEM and EFI_PCI_HOST_BRIDGE_MEM64_DECODE used by GetAllocAttributes()
in EFI_PCI_HOST_BRIDGE_RESOURCE_ALLOCATION_PROTOCOL defined in PI Specification.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Bus</span></code></p>
<p>Bus aperture for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Io</span></code></p>
<p>IO aperture for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Mem</span></code></p>
<p>MMIO aperture below 4GB for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].MemAbove4G</span></code></p>
<p>MMIO aperture above 4GB for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].PMem</span></code></p>
<p>Prefetchable MMIO aperture below 4GB for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].PMemAbove4G</span></code></p>
<p>Prefetchable MMIO aperture above 4GB for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].HID</span></code></p>
<p>PnP hardware ID of the root bridge. This value must match the corresponding _HID in the ACPI name space.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].UID</span></code></p>
<p>Unique ID that is required by ACPI if two devices have the same _HID. This value must also match the corresponding _UID/_HID pair in the ACPI name space.</p>
</section>
<section id="secureboot-information">
<h5><span class="section-number">2.13.2.2.7. </span>Secureboot Information<a class="headerlink" href="#secureboot-information" title="Permalink to this heading">¶</a></h5>
<p>This provides the information related to secure boot and measured boot enablement.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalSecureBootInfoGuid</span>   <span class="o">=</span> <span class="p">{</span><span class="mh">0xd970f847</span><span class="p">,</span> <span class="mh">0x07dd</span><span class="p">,</span> <span class="mh">0x4b24</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x38</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack(1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span>    <span class="n">Header</span><span class="p">;</span>
  <span class="n">UINT8</span>  <span class="n">VerifiedBootEnabled</span><span class="p">;</span>
  <span class="n">UINT8</span>  <span class="n">MeasuredBootEnabled</span><span class="p">;</span>
  <span class="n">UINT8</span>  <span class="n">FirmwareDebuggerInitialized</span><span class="p">;</span>
  <span class="n">UINT8</span>  <span class="n">TpmType</span><span class="p">;</span>
  <span class="n">UINT32</span> <span class="n">TpmPcrActivePcrBanks</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_SECURE_BOOT_INFO</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 12.</p>
<p><code class="docutils literal notranslate"><span class="pre">VerifiedBootEnabled</span></code></p>
<p>Indicates verified boot is enabled in bootloader. This information can be used in payload to extend chain of trust to OS.
Supported values 0/1 to indicate the verified boot status.</p>
<p><code class="docutils literal notranslate"><span class="pre">MeasuredBootEnabled</span></code></p>
<p>Indicates measured boot is enabled in bootloader. This information can be used in payload to extend measurements for OS boot as per TCG specifications.
Supported values 0/1 to indicate the measured boot status.</p>
<p><code class="docutils literal notranslate"><span class="pre">FirmwareDebuggerInitialized</span></code></p>
<p>Indicates platform is Sample part or manufacturing mode or debug mode. Extend the PCR[7] if value is true.
Supported values 0/1 to indicate the debug state of platform.</p>
<p><code class="docutils literal notranslate"><span class="pre">TpmType</span></code></p>
<p>Indicates that the TPM Type is enumerated. This can be TPM 1.2, TPM 2.0, or no TPM.</p>
<p>NO_TPM               0x0</p>
<p>TPM_TYPE_12          0x1</p>
<p>TPM_TYPE_20          0x2</p>
<p><code class="docutils literal notranslate"><span class="pre">TpmPcrActivePcrBanks</span></code></p>
<p>Indicates the TPM PCR active banks.</p>
<p>BIT0  -  SHA-1</p>
<p>BIT1  -  SHA-256</p>
<p>BIT2  -  SHA-384</p>
<p>BIT3  -  SHA-512</p>
<p>BIT4  -  SM3-256</p>
</section>
<section id="tpm-2-0-event-information">
<h5><span class="section-number">2.13.2.2.8. </span>TPM 2.0 Event Information<a class="headerlink" href="#tpm-2-0-event-information" title="Permalink to this heading">¶</a></h5>
<p>This provides the information about the TPM 2.0 events extended by bootloader. Bootloader has to create separate hobs for each TPM event.
This is a TCG spec defined EFI_TCG2_PROTOCOL HOB for the event log.</p>
<p>Bootloader should follow the same order to create event HOBs in the order events are extended to TPM. Mismatch in order will lead a failure
in TPM PCR replay.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gTcgEvent2EntryHobGuid</span>                        <span class="o">=</span> <span class="p">{</span> <span class="mh">0xd26c221e</span><span class="p">,</span> <span class="mh">0x2430</span><span class="p">,</span> <span class="mh">0x4c8a</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x3f</span>  <span class="p">}</span> <span class="p">}</span>

<span class="n">HOB</span> <span class="n">GUID</span> <span class="n">defined</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tianocore</span><span class="o">/</span><span class="n">edk2</span><span class="o">/</span><span class="n">blob</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">SecurityPkg</span><span class="o">/</span><span class="n">Include</span><span class="o">/</span><span class="n">Guid</span><span class="o">/</span><span class="n">TcgEventHob</span><span class="o">.</span><span class="n">h</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="c1">#pragma pack(1)</span>

 <span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
   <span class="n">TCG_PCRINDEX</span>        <span class="n">PCRIndex</span><span class="p">;</span>
   <span class="n">TCG_EVENTTYPE</span>       <span class="n">EventType</span><span class="p">;</span>
   <span class="n">TPML_DIGEST_VALUES</span>  <span class="n">Digest</span><span class="p">;</span>
   <span class="n">UINT32</span>              <span class="n">EventSize</span><span class="p">;</span>
   <span class="n">UINT8</span>               <span class="n">Event</span><span class="p">[</span><span class="n">EventSize</span><span class="p">];</span>
 <span class="p">}</span> <span class="n">TCG_PCR_EVENT2</span><span class="p">;</span>

 <span class="c1">#pragma pack()</span>

<span class="n">TCG_PCR_EVENT2</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">defined</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tianocore</span><span class="o">/</span><span class="n">edk2</span><span class="o">/</span><span class="n">blob</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">MdePkg</span><span class="o">/</span><span class="n">Include</span><span class="o">/</span><span class="n">IndustryStandard</span><span class="o">/</span><span class="n">UefiTcgPlatform</span><span class="o">.</span><span class="n">h</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">PcrIndex</span></code></p>
<p>Indicates the PCR bank for event.</p>
<p><code class="docutils literal notranslate"><span class="pre">EventType</span></code></p>
<p>Type of TPM event extended.</p>
<p><code class="docutils literal notranslate"><span class="pre">Digest</span></code></p>
<p>Indicates the digest/hash for the event.
Defined at <a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/IndustryStandard/Tpm20.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/IndustryStandard/Tpm20.h</a></p>
<p><code class="docutils literal notranslate"><span class="pre">EventSize</span></code></p>
<p>Size of the event buffer</p>
<p><code class="docutils literal notranslate"><span class="pre">Event</span></code></p>
<p>Event buffer</p>
</section>
<section id="tpm-1-2-event-information">
<h5><span class="section-number">2.13.2.2.9. </span>TPM 1.2 Event Information<a class="headerlink" href="#tpm-1-2-event-information" title="Permalink to this heading">¶</a></h5>
<p>This provides the information about the TPM 1.2 events extended by bootloader. Bootloader has to create separate hobs for each TPM event.
This is a TCG spec defined EFI_TCG2_PROTOCOL HOB for the event log.</p>
<p>Bootloader should follow the same order to create event HOBs in the order events are extended to TPM. Mismatch in order will lead a failure
in TPM PCR replay.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gTcgEventEntryHobGuid</span>                        <span class="o">=</span> <span class="p">{</span> <span class="mh">0x2b9ffb52</span><span class="p">,</span> <span class="mh">0x1b13</span><span class="p">,</span> <span class="mh">0x416f</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0xd</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0xa8</span> <span class="p">}}</span>

<span class="n">HOB</span> <span class="n">GUID</span> <span class="n">defined</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tianocore</span><span class="o">/</span><span class="n">edk2</span><span class="o">/</span><span class="n">blob</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">SecurityPkg</span><span class="o">/</span><span class="n">Include</span><span class="o">/</span><span class="n">Guid</span><span class="o">/</span><span class="n">TcgEventHob</span><span class="o">.</span><span class="n">h</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack(1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT8</span>                             <span class="n">digest</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="p">}</span> <span class="n">TPM_DIGEST</span><span class="p">;</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT32</span>              <span class="n">PCRIndex</span><span class="p">;</span>
  <span class="n">UINT32</span>              <span class="n">EventType</span><span class="p">;</span>
  <span class="n">TPM_DIGEST</span>          <span class="n">Digest</span><span class="p">;</span>
  <span class="n">UINT32</span>              <span class="n">EventSize</span><span class="p">;</span>
  <span class="n">UINT8</span>               <span class="n">Event</span><span class="p">[</span><span class="n">EventSize</span><span class="p">];</span>
<span class="p">}</span> <span class="n">TCG_PCR_EVENT</span><span class="p">;</span>

 <span class="n">TCG_PCR_EVENT</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">defined</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tianocore</span><span class="o">/</span><span class="n">edk2</span><span class="o">/</span><span class="n">blob</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">MdePkg</span><span class="o">/</span><span class="n">Include</span><span class="o">/</span><span class="n">IndustryStandard</span><span class="o">/</span><span class="n">UefiTcgPlatform</span><span class="o">.</span><span class="n">h</span>


<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">PcrIndex</span></code></p>
<p>Indicates the PCR bank for event.</p>
<p><code class="docutils literal notranslate"><span class="pre">EventType</span></code></p>
<p>Type of TPM event extended.</p>
<p><code class="docutils literal notranslate"><span class="pre">Digest</span></code></p>
<p>Indicates the digest/hash for the event.
Defined at <a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/IndustryStandard/Tpm12.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/IndustryStandard/Tpm12.h</a></p>
<p><code class="docutils literal notranslate"><span class="pre">EventSize</span></code></p>
<p>Size of the event buffer</p>
<p><code class="docutils literal notranslate"><span class="pre">Event</span></code></p>
<p>Event buffer</p>
</section>
<section id="trace-hub-hob-information">
<h5><span class="section-number">2.13.2.2.10. </span>Trace Hub HOB Information<a class="headerlink" href="#trace-hub-hob-information" title="Permalink to this heading">¶</a></h5>
<p>This structure stores necessary information which consumed by Trace Hub debug library to dump Trace Hub message.
Multiple Trace Hub HOBs are allowed to do multiple debug output.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gTraceHubDebugInfoHobGuid</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0xf88c9c23</span><span class="p">,</span> <span class="mh">0x646c</span><span class="p">,</span> <span class="mh">0x4f6c</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0xa9</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">}}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT16</span>     <span class="n">Revision</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>    <span class="n">Flag</span><span class="p">;</span>
  <span class="n">UINT8</span>      <span class="n">DebugLevel</span><span class="p">;</span>
  <span class="n">UINT8</span>      <span class="n">Rvsd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="n">UINT64</span>     <span class="n">TraceHubMmioAddress</span><span class="p">;</span>
<span class="p">}</span> <span class="n">TRACEHUB_DEBUG_INFO_HOB</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Revision</span></code></p>
<p>Revision is 1.</p>
<p><code class="docutils literal notranslate"><span class="pre">Flag</span></code></p>
<p>Flag to enable or disable Trace Hub debug message.</p>
<p><code class="docutils literal notranslate"><span class="pre">DebugLevel</span></code></p>
<p>Debug level for Trace Hub.</p>
<p><code class="docutils literal notranslate"><span class="pre">Rvsd[4]</span></code></p>
<p>Reserved bytes for natural alignment.</p>
<p><code class="docutils literal notranslate"><span class="pre">TraceHubMmioAddress</span></code></p>
<p>MMIO address where Trace Hub debug message output to.</p>
</section>
</section>
<section id="optional-interfaces">
<h4><span class="section-number">2.13.2.3. </span>Optional Interfaces<a class="headerlink" href="#optional-interfaces" title="Permalink to this heading">¶</a></h4>
<p>Some more HOBs could be built by bootloaders for advanced features. e.g.:</p>
<blockquote>
<div><p>Support FVs (also other format) from bootloader to payload</p>
<p>Add debug log as HOB to payload</p>
</div></blockquote>
<p><strong>Opens</strong>: Does the bootloader need report IO info to payload?</p>
<blockquote>
<div><p>Better let the bootloader to report it,</p>
</div></blockquote>
<p><strong>Opens</strong>: does the HOB List need a checksum?</p>
<blockquote>
<div><p>It looks not too much value. Keep it open if we really need it.</p>
</div></blockquote>
<p><strong>Opens</strong>: For some information it is already in ACPI table, should bootloader build HOB for same info?</p>
<blockquote>
<div><p>Payload could have a check to ACPI table to get basic info they need.</p>
</div></blockquote>
</section>
</section>
</section>
<section id="hob-data-structures">
<h2><span class="section-number">2.14. </span>HOB Data Structures<a class="headerlink" href="#hob-data-structures" title="Permalink to this heading">¶</a></h2>
<p>The declarations/definitions provided here are derived from the EDKII at <a class="reference external" href="https://github.com/tianocore/edk2">https://github.com/tianocore/edk2</a></p>
<section id="base-data-type">
<h3><span class="section-number">2.14.1. </span>Base Data Type<a class="headerlink" href="#base-data-type" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Base.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Base.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT32</span>     <span class="n">Data1</span><span class="p">;</span>
  <span class="n">UINT16</span>     <span class="n">Data2</span><span class="p">;</span>
  <span class="n">UINT16</span>     <span class="n">Data3</span><span class="p">;</span>
  <span class="n">UINT8</span>      <span class="n">Data4</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span> <span class="n">GUID</span><span class="p">;</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Uefi/UefiBaseType.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Uefi/UefiBaseType.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span>    <span class="n">GUID</span>       <span class="n">EFI_GUID</span><span class="p">;</span>
<span class="n">typedef</span>    <span class="n">UINT64</span>     <span class="n">EFI_PHYSICAL_ADDRESS</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="efi-hob-type">
<h3><span class="section-number">2.14.2. </span>EFI HOB TYPE<a class="headerlink" href="#efi-hob-type" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span>
<span class="o">//</span> <span class="n">HobType</span> <span class="n">of</span> <span class="n">EFI_HOB_GENERIC_HEADER</span><span class="o">.</span>
<span class="o">//</span>
<span class="c1">#define EFI_HOB_TYPE_HANDOFF              0x0001</span>
<span class="c1">#define EFI_HOB_TYPE_MEMORY_ALLOCATION    0x0002</span>
<span class="c1">#define EFI_HOB_TYPE_RESOURCE_DESCRIPTOR  0x0003</span>
<span class="c1">#define EFI_HOB_TYPE_GUID_EXTENSION       0x0004</span>
<span class="c1">#define EFI_HOB_TYPE_FV                   0x0005</span>
<span class="c1">#define EFI_HOB_TYPE_CPU                  0x0006</span>
<span class="c1">#define EFI_HOB_TYPE_MEMORY_POOL          0x0007</span>
<span class="c1">#define EFI_HOB_TYPE_FV2                  0x0009</span>
<span class="c1">#define EFI_HOB_TYPE_LOAD_PEIM_UNUSED     0x000A</span>
<span class="c1">#define EFI_HOB_TYPE_UEFI_CAPSULE         0x000B</span>
<span class="c1">#define EFI_HOB_TYPE_FV3                  0x000C</span>
<span class="c1">#define EFI_HOB_TYPE_UNUSED               0xFFFE</span>
<span class="c1">#define EFI_HOB_TYPE_END_OF_HOB_LIST      0xFFFF</span>
</pre></div>
</div>
</section>
<section id="efi-hob-generic-header">
<h3><span class="section-number">2.14.3. </span>EFI_HOB_GENERIC_HEADER<a class="headerlink" href="#efi-hob-generic-header" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">Describes</span> <span class="n">the</span> <span class="nb">format</span> <span class="ow">and</span> <span class="n">size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">data</span> <span class="n">inside</span> <span class="n">the</span> <span class="n">HOB</span><span class="o">.</span>
<span class="o">///</span> <span class="n">All</span> <span class="n">HOBs</span> <span class="n">must</span> <span class="n">contain</span> <span class="n">this</span> <span class="n">generic</span> <span class="n">HOB</span> <span class="n">header</span><span class="o">.</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Identifies</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">data</span> <span class="n">structure</span> <span class="nb">type</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT16</span>   <span class="n">HobType</span><span class="p">;</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">the</span> <span class="n">HOB</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT16</span>   <span class="n">HobLength</span><span class="p">;</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">This</span> <span class="n">field</span> <span class="n">must</span> <span class="n">always</span> <span class="n">be</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">zero</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT32</span>   <span class="n">Reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">EFI_HOB_GENERIC_HEADER</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="hob-list-header">
<h3><span class="section-number">2.14.4. </span>HOB List Header<a class="headerlink" href="#hob-list-header" title="Permalink to this heading">¶</a></h3>
<section id="efi-hob-handoff-info-table">
<h4><span class="section-number">2.14.4.1. </span>EFI_HOB_HANDOFF_INFO_TABLE<a class="headerlink" href="#efi-hob-handoff-info-table" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">Contains</span> <span class="n">general</span> <span class="n">state</span> <span class="n">information</span> <span class="n">used</span> <span class="n">by</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producerphase</span><span class="o">.</span>
<span class="o">///</span> <span class="n">This</span> <span class="n">HOB</span> <span class="n">must</span> <span class="n">be</span> <span class="n">the</span> <span class="n">first</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">HOB</span> <span class="nb">list</span><span class="o">.</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">HOB</span> <span class="n">generic</span> <span class="n">header</span><span class="o">.</span> <span class="n">Header</span><span class="o">.</span><span class="n">HobType</span> <span class="o">=</span> <span class="n">EFI_HOB_TYPE_HANDOFF</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_HOB_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">version</span> <span class="n">number</span> <span class="n">pertaining</span> <span class="n">to</span> <span class="n">the</span> <span class="n">PHIT</span> <span class="n">HOB</span> <span class="n">definition</span><span class="o">.</span>
  <span class="o">///</span> <span class="n">This</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">four</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="n">length</span> <span class="n">to</span> <span class="n">provide</span> <span class="n">an</span> <span class="mi">8</span><span class="o">-</span><span class="n">byte</span> <span class="n">aligned</span> <span class="n">entry</span>
  <span class="o">///</span> <span class="n">when</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">combined</span> <span class="k">with</span> <span class="n">the</span> <span class="mi">4</span><span class="o">-</span><span class="n">byte</span> <span class="n">BootMode</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT32</span> <span class="n">Version</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">system</span> <span class="n">boot</span> <span class="n">mode</span> <span class="k">as</span> <span class="n">determined</span> <span class="n">during</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producer</span> <span class="n">phase</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_BOOT_MODE</span> <span class="n">BootMode</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">highest</span> <span class="n">address</span> <span class="n">location</span> <span class="n">of</span> <span class="n">memory</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">allocated</span> <span class="k">for</span> <span class="n">use</span> <span class="n">by</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producer</span>
  <span class="o">///</span> <span class="n">phase</span><span class="o">.</span> <span class="n">This</span> <span class="n">address</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">4</span><span class="o">-</span><span class="n">KB</span> <span class="n">aligned</span> <span class="n">to</span> <span class="n">meet</span> <span class="n">page</span> <span class="n">restrictions</span> <span class="n">of</span> <span class="n">UEFI</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span> <span class="n">EfiMemoryTop</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">lowest</span> <span class="n">address</span> <span class="n">location</span> <span class="n">of</span> <span class="n">memory</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">allocated</span> <span class="k">for</span> <span class="n">use</span> <span class="n">by</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producer</span> <span class="n">phase</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span> <span class="n">EfiMemoryBottom</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">highest</span> <span class="n">address</span> <span class="n">location</span> <span class="n">of</span> <span class="n">free</span> <span class="n">memory</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">available</span>
  <span class="o">///</span> <span class="k">for</span> <span class="n">use</span> <span class="n">by</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producer</span> <span class="n">phase</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span> <span class="n">EfiFreeMemoryTop</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">lowest</span> <span class="n">address</span> <span class="n">location</span> <span class="n">of</span> <span class="n">free</span> <span class="n">memory</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">available</span> <span class="k">for</span> <span class="n">use</span> <span class="n">by</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producer</span> <span class="n">phase</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span> <span class="n">EfiFreeMemoryBottom</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">end</span> <span class="n">of</span> <span class="n">the</span> <span class="n">HOB</span> <span class="nb">list</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span> <span class="n">EfiEndOfHobList</span><span class="p">;</span>
<span class="p">}</span> <span class="n">EFI_HOB_HANDOFF_INFO_TABLE</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="efi-hob-handoff-table-version">
<h4><span class="section-number">2.14.4.2. </span>EFI_HOB_HANDOFF_TABLE_VERSION<a class="headerlink" href="#efi-hob-handoff-table-version" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">Value</span> <span class="n">of</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">EFI_HOB_HANDOFF_INFO_TABLE</span><span class="o">.</span>
<span class="o">///</span>
<span class="c1">#define    EFI_HOB_HANDOFF_TABLE_VERSION    0x0009</span>
</pre></div>
</div>
</section>
<section id="efi-boot-mode">
<h4><span class="section-number">2.14.4.3. </span>EFI_BOOT_MODE<a class="headerlink" href="#efi-boot-mode" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiBootMode.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiBootMode.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">EFI</span> <span class="n">boot</span> <span class="n">mode</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">UINT32</span> <span class="n">EFI_BOOT_MODE</span><span class="p">;</span>

<span class="o">//</span>
<span class="o">//</span> <span class="mh">0x21</span> <span class="o">-</span> <span class="mh">0xff</span> <span class="n">are</span> <span class="n">reserved</span><span class="o">.</span>
<span class="o">//</span>
<span class="c1">#define BOOT_WITH_FULL_CONFIGURATION                  0x00</span>
<span class="c1">#define BOOT_WITH_MINIMAL_CONFIGURATION               0x01</span>
<span class="c1">#define BOOT_ASSUMING_NO_CONFIGURATION_CHANGES        0x02</span>
<span class="c1">#define BOOT_WITH_FULL_CONFIGURATION_PLUS_DIAGNOSTICS 0x03</span>
<span class="c1">#define BOOT_WITH_DEFAULT_SETTINGS                    0x04</span>
<span class="c1">#define BOOT_ON_S4_RESUME                             0x05</span>
<span class="c1">#define BOOT_ON_S5_RESUME                             0x06</span>
<span class="c1">#define BOOT_WITH_MFG_MODE_SETTINGS                   0x07</span>
<span class="c1">#define BOOT_ON_S2_RESUME                             0x10</span>
<span class="c1">#define BOOT_ON_S3_RESUME                             0x11</span>
<span class="c1">#define BOOT_ON_FLASH_UPDATE                          0x12</span>
<span class="c1">#define BOOT_IN_RECOVERY_MODE                         0x20</span>
</pre></div>
</div>
</section>
</section>
<section id="efi-hob-guid-type">
<h3><span class="section-number">2.14.5. </span>EFI_HOB_GUID_TYPE<a class="headerlink" href="#efi-hob-guid-type" title="Permalink to this heading">¶</a></h3>
<p>This is the generic HOB header for GUID type HOB.</p>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">Allows</span> <span class="n">writers</span> <span class="n">of</span> <span class="n">executable</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producer</span> <span class="n">phase</span> <span class="n">to</span>
<span class="o">///</span> <span class="n">maintain</span> <span class="ow">and</span> <span class="n">manage</span> <span class="n">HOBs</span> <span class="k">with</span> <span class="n">specific</span> <span class="n">GUID</span><span class="o">.</span>
<span class="o">///</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">HOB</span> <span class="n">generic</span> <span class="n">header</span><span class="o">.</span> <span class="n">Header</span><span class="o">.</span><span class="n">HobType</span> <span class="o">=</span> <span class="n">EFI_HOB_TYPE_GUID_EXTENSION</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_HOB_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">A</span> <span class="n">GUID</span> <span class="n">that</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">this</span> <span class="n">HOB</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_GUID</span> <span class="n">Name</span><span class="p">;</span>

  <span class="o">//</span>
  <span class="o">//</span> <span class="n">Guid</span> <span class="n">specific</span> <span class="n">data</span> <span class="n">goes</span> <span class="n">here</span>
  <span class="o">//</span>
<span class="p">}</span> <span class="n">EFI_HOB_GUID_TYPE</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="efi-pei-graphics-info-hob">
<h3><span class="section-number">2.14.6. </span>EFI_PEI_GRAPHICS_INFO_HOB<a class="headerlink" href="#efi-pei-graphics-info-hob" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Guid/GraphicsInfoHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Guid/GraphicsInfoHob.h</a></p>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Protocol/GraphicsOutput.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Protocol/GraphicsOutput.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">HOB</span> <span class="n">GUID</span><span class="o">**</span>
<span class="c1">#define    EFI_PEI_GRAPHICS_INFO_HOB_GUID    {0x39f62cce, 0x6825, 0x4669, {0xbb, 0x56, 0x54, 0x1a, 0xba, 0x75, 0x3a, 0x07}}</span>
</pre></div>
</div>
<p><strong>Hob Interface Structure</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>                    <span class="n">FrameBufferBase</span><span class="p">;</span>
  <span class="n">UINT32</span>                                  <span class="n">FrameBufferSize</span><span class="p">;</span>
  <span class="n">EFI_GRAPHICS_OUTPUT_MODE_INFORMATION</span>    <span class="n">GraphicsMode</span><span class="p">;</span>
<span class="p">}</span> <span class="n">EFI_PEI_GRAPHICS_INFO_HOB</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Related Definitions</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT32</span> <span class="n">RedMask</span><span class="p">;</span>
  <span class="n">UINT32</span> <span class="n">GreenMask</span><span class="p">;</span>
  <span class="n">UINT32</span> <span class="n">BlueMask</span><span class="p">;</span>
  <span class="n">UINT32</span> <span class="n">ReservedMask</span><span class="p">;</span>
<span class="p">}</span> <span class="n">EFI_PIXEL_BITMASK</span><span class="p">;</span>
</pre></div>
</div>
<p>If a bit is set in <em>RedMask</em>, <em>GreenMask</em>, or <em>BlueMask</em> then those bits of the pixel represent the
corresponding color. Bits in <em>RedMask</em>, <em>GreenMask</em>, <em>BlueMask</em>, and <em>ReserverdMask</em> must not overlap bit
positions. The values for the red, green, and blue components in the bit mask represent the color
intensity. The color intensities must increase as the color values for each color mask increase with a
minimum intensity of all bits in a color mask clear to a maximum intensity of all bits in a color mask set.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">enum</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">A</span> <span class="n">pixel</span> <span class="ow">is</span> <span class="mi">32</span><span class="o">-</span><span class="n">bits</span> <span class="ow">and</span> <span class="n">byte</span> <span class="n">zero</span> <span class="n">represents</span> <span class="n">red</span><span class="p">,</span> <span class="n">byte</span> <span class="n">one</span> <span class="n">represents</span> <span class="n">green</span><span class="p">,</span>
  <span class="o">///</span> <span class="n">byte</span> <span class="n">two</span> <span class="n">represents</span> <span class="n">blue</span><span class="p">,</span> <span class="ow">and</span> <span class="n">byte</span> <span class="n">three</span> <span class="ow">is</span> <span class="n">reserved</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">definition</span>
  <span class="o">///</span> <span class="k">for</span> <span class="n">the</span> <span class="n">physical</span> <span class="n">frame</span> <span class="n">buffer</span><span class="o">.</span> <span class="n">The</span> <span class="n">byte</span> <span class="n">values</span> <span class="k">for</span> <span class="n">the</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="ow">and</span> <span class="n">blue</span>
  <span class="o">///</span> <span class="n">components</span> <span class="n">represent</span> <span class="n">the</span> <span class="n">color</span> <span class="n">intensity</span><span class="o">.</span> <span class="n">This</span> <span class="n">color</span> <span class="n">intensity</span> <span class="n">value</span> <span class="nb">range</span>
  <span class="o">///</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">minimum</span> <span class="n">intensity</span> <span class="n">of</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">maximum</span> <span class="n">intensity</span> <span class="n">of</span> <span class="mf">255.</span>
  <span class="o">///</span>
  <span class="n">PixelRedGreenBlueReserved8BitPerColor</span><span class="p">,</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">A</span> <span class="n">pixel</span> <span class="ow">is</span> <span class="mi">32</span><span class="o">-</span><span class="n">bits</span> <span class="ow">and</span> <span class="n">byte</span> <span class="n">zero</span> <span class="n">represents</span> <span class="n">blue</span><span class="p">,</span> <span class="n">byte</span> <span class="n">one</span> <span class="n">represents</span> <span class="n">green</span><span class="p">,</span>
  <span class="o">///</span> <span class="n">byte</span> <span class="n">two</span> <span class="n">represents</span> <span class="n">red</span><span class="p">,</span> <span class="ow">and</span> <span class="n">byte</span> <span class="n">three</span> <span class="ow">is</span> <span class="n">reserved</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">definition</span>
  <span class="o">///</span> <span class="k">for</span> <span class="n">the</span> <span class="n">physical</span> <span class="n">frame</span> <span class="n">buffer</span><span class="o">.</span> <span class="n">The</span> <span class="n">byte</span> <span class="n">values</span> <span class="k">for</span> <span class="n">the</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="ow">and</span> <span class="n">blue</span>
  <span class="o">///</span> <span class="n">components</span> <span class="n">represent</span> <span class="n">the</span> <span class="n">color</span> <span class="n">intensity</span><span class="o">.</span> <span class="n">This</span> <span class="n">color</span> <span class="n">intensity</span> <span class="n">value</span> <span class="nb">range</span>
  <span class="o">///</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">minimum</span> <span class="n">intensity</span> <span class="n">of</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">maximum</span> <span class="n">intensity</span> <span class="n">of</span> <span class="mf">255.</span>
  <span class="o">///</span>
  <span class="n">PixelBlueGreenRedReserved8BitPerColor</span><span class="p">,</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">Pixel</span> <span class="n">definition</span> <span class="n">of</span> <span class="n">the</span> <span class="n">physical</span> <span class="n">frame</span> <span class="n">buffer</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">PixelBitMask</span><span class="p">,</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">This</span> <span class="n">mode</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">a</span> <span class="n">physical</span> <span class="n">frame</span> <span class="n">buffer</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">PixelBltOnly</span><span class="p">,</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Valid</span> <span class="n">EFI_GRAPHICS_PIXEL_FORMAT</span> <span class="n">enum</span> <span class="n">values</span> <span class="n">are</span> <span class="n">less</span> <span class="n">than</span> <span class="n">this</span> <span class="n">value</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">PixelFormatMax</span>
<span class="p">}</span> <span class="n">EFI_GRAPHICS_PIXEL_FORMAT</span><span class="p">;</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">version</span> <span class="n">of</span> <span class="n">this</span> <span class="n">data</span> <span class="n">structure</span><span class="o">.</span> <span class="n">A</span> <span class="n">value</span> <span class="n">of</span> <span class="n">zero</span> <span class="n">represents</span> <span class="n">the</span>
  <span class="o">///</span> <span class="n">EFI_GRAPHICS_OUTPUT_MODE_INFORMATION</span> <span class="n">structure</span> <span class="k">as</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">specification</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT32</span> <span class="n">Version</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">size</span> <span class="n">of</span> <span class="n">video</span> <span class="n">screen</span> <span class="ow">in</span> <span class="n">pixels</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">X</span> <span class="n">dimension</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT32</span> <span class="n">HorizontalResolution</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">size</span> <span class="n">of</span> <span class="n">video</span> <span class="n">screen</span> <span class="ow">in</span> <span class="n">pixels</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Y</span> <span class="n">dimension</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT32</span> <span class="n">VerticalResolution</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Enumeration</span> <span class="n">that</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">physical</span> <span class="nb">format</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pixel</span><span class="o">.</span> <span class="n">A</span> <span class="n">value</span> <span class="n">of</span> <span class="n">PixelBltOnly</span>
  <span class="o">///</span> <span class="n">implies</span> <span class="n">that</span> <span class="n">a</span> <span class="n">linear</span> <span class="n">frame</span> <span class="n">buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">available</span> <span class="k">for</span> <span class="n">this</span> <span class="n">mode</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_GRAPHICS_PIXEL_FORMAT</span> <span class="n">PixelFormat</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">This</span> <span class="n">bitmask</span> <span class="ow">is</span> <span class="n">only</span> <span class="n">valid</span> <span class="k">if</span> <span class="n">PixelFormat</span> <span class="ow">is</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">PixelPixelBitMask</span><span class="o">.</span>
  <span class="o">///</span> <span class="n">A</span> <span class="n">bit</span> <span class="n">being</span> <span class="nb">set</span> <span class="n">defines</span> <span class="n">what</span> <span class="n">bits</span> <span class="n">are</span> <span class="n">used</span> <span class="k">for</span> <span class="n">what</span> <span class="n">purpose</span> <span class="n">such</span> <span class="k">as</span> <span class="n">Red</span><span class="p">,</span> <span class="n">Green</span><span class="p">,</span> <span class="n">Blue</span><span class="p">,</span> <span class="ow">or</span> <span class="n">Reserved</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_PIXEL_BITMASK</span> <span class="n">PixelInformation</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Defines</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">pixel</span> <span class="n">elements</span> <span class="n">per</span> <span class="n">video</span> <span class="n">memory</span> <span class="n">line</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT32</span> <span class="n">PixelsPerScanLine</span><span class="p">;</span>
<span class="p">}</span> <span class="n">EFI_GRAPHICS_OUTPUT_MODE_INFORMATION</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> for performance reasons, or due to hardware restrictions,
scan lines may be padded to an amount of memory alignment. These
padding pixel elements are outside the area covered by
<em>HorizontalResolution</em> and are not visible. For direct frame buffer
access, this number is used as a span between starts of pixel lines
in video memory. Based on the size of an individual pixel element and
<em>PixelsPerScanline</em>, the offset in video memory from pixel element
(x, y) to pixel element (x, y+1) has to be calculated as “sizeof(
PixelElement ) * PixelsPerScanLine”, not “sizeof( PixelElement ) *
HorizontalResolution”, though in many cases those values can
coincide. This value can depend on video hardware and mode
resolution. GOP implementation is responsible for providing accurate
value for this field.</p>
</section>
<section id="efi-pei-graphics-device-info-hob">
<h3><span class="section-number">2.14.7. </span>EFI_PEI_GRAPHICS_DEVICE_INFO_HOB<a class="headerlink" href="#efi-pei-graphics-device-info-hob" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Guid/GraphicsInfoHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Guid/GraphicsInfoHob.h</a></p>
<p><strong>HOB GUID</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define    EFI_PEI_GRAPHICS_DEVICE_INFO_HOB_GUID    {0xe5cb2ac9, 0xd35d, 0x4430, {0x93, 0x6e, 0x1d, 0xe3, 0x32, 0x47, 0x8d, 0xe7}}</span>
</pre></div>
</div>
<p><strong>Hob Interface Structure</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT16</span>   <span class="n">VendorId</span><span class="p">;</span>          <span class="o">///&lt;</span> <span class="n">Ignore</span> <span class="k">if</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">is</span> <span class="mh">0xFFFF</span><span class="o">.</span>
  <span class="n">UINT16</span>   <span class="n">DeviceId</span><span class="p">;</span>          <span class="o">///&lt;</span> <span class="n">Ignore</span> <span class="k">if</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">is</span> <span class="mh">0xFFFF</span><span class="o">.</span>
  <span class="n">UINT16</span>   <span class="n">SubsystemVendorId</span><span class="p">;</span> <span class="o">///&lt;</span> <span class="n">Ignore</span> <span class="k">if</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">is</span> <span class="mh">0xFFFF</span><span class="o">.</span>
  <span class="n">UINT16</span>   <span class="n">SubsystemId</span><span class="p">;</span>       <span class="o">///&lt;</span> <span class="n">Ignore</span> <span class="k">if</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">is</span> <span class="mh">0xFFFF</span><span class="o">.</span>
  <span class="n">UINT8</span>    <span class="n">RevisionId</span><span class="p">;</span>        <span class="o">///&lt;</span> <span class="n">Ignore</span> <span class="k">if</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">is</span> <span class="mh">0xFF</span><span class="o">.</span>
  <span class="n">UINT8</span>    <span class="n">BarIndex</span><span class="p">;</span>          <span class="o">///&lt;</span> <span class="n">Ignore</span> <span class="k">if</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">is</span> <span class="mh">0xFF</span><span class="o">.</span>
<span class="p">}</span> <span class="n">EFI_PEI_GRAPHICS_DEVICE_INFO_HOB</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="efi-hob-resource-descriptor">
<h3><span class="section-number">2.14.8. </span>EFI_HOB_RESOURCE_DESCRIPTOR<a class="headerlink" href="#efi-hob-resource-descriptor" title="Permalink to this heading">¶</a></h3>
<section id="efi-resource-type">
<h4><span class="section-number">2.14.8.1. </span>EFI_RESOURCE_TYPE<a class="headerlink" href="#efi-resource-type" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">The</span> <span class="n">resource</span> <span class="nb">type</span><span class="o">.</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">UINT32</span> <span class="n">EFI_RESOURCE_TYPE</span><span class="p">;</span>

<span class="o">//</span>
<span class="o">//</span> <span class="n">Value</span> <span class="n">of</span> <span class="n">ResourceType</span> <span class="ow">in</span> <span class="n">EFI_HOB_RESOURCE_DESCRIPTOR</span><span class="o">.</span>
<span class="o">//</span>
<span class="c1">#define EFI_RESOURCE_SYSTEM_MEMORY          0x00000000</span>
<span class="c1">#define EFI_RESOURCE_MEMORY_MAPPED_IO       0x00000001</span>
<span class="c1">#define EFI_RESOURCE_IO                     0x00000002</span>
<span class="c1">#define EFI_RESOURCE_FIRMWARE_DEVICE        0x00000003</span>
<span class="c1">#define EFI_RESOURCE_MEMORY_MAPPED_IO_PORT  0x00000004</span>
<span class="c1">#define EFI_RESOURCE_MEMORY_RESERVED        0x00000005</span>
<span class="c1">#define EFI_RESOURCE_IO_RESERVED            0x00000006</span>
<span class="c1">#define EFI_RESOURCE_MAX_MEMORY_TYPE        0x00000007</span>
</pre></div>
</div>
</section>
<section id="efi-resource-attribute-type">
<h4><span class="section-number">2.14.8.2. </span>EFI_RESOURCE_ATTRIBUTE_TYPE<a class="headerlink" href="#efi-resource-attribute-type" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">A</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">recount</span> <span class="n">attribute</span> <span class="nb">type</span><span class="o">.</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">UINT32</span> <span class="n">EFI_RESOURCE_ATTRIBUTE_TYPE</span><span class="p">;</span>

<span class="o">//</span>
<span class="o">//</span> <span class="n">These</span> <span class="n">types</span> <span class="n">can</span> <span class="n">be</span> <span class="n">ORed</span> <span class="n">together</span> <span class="k">as</span> <span class="n">needed</span><span class="o">.</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">The</span> <span class="n">following</span> <span class="n">attributes</span> <span class="n">are</span> <span class="n">used</span> <span class="n">to</span> <span class="n">describe</span> <span class="n">settings</span>
<span class="o">//</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_PRESENT                  0x00000001</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_INITIALIZED              0x00000002</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_TESTED                   0x00000004</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_READ_PROTECTED           0x00000080</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">typically</span> <span class="n">used</span> <span class="k">as</span> <span class="n">memory</span> <span class="n">cacheability</span> <span class="n">attribute</span> <span class="n">today</span><span class="o">.</span>
<span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Since</span> <span class="n">PI</span> <span class="n">spec</span> <span class="mf">1.4</span><span class="p">,</span> <span class="n">please</span> <span class="n">use</span> <span class="n">EFI_RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTED</span>
<span class="o">//</span> <span class="k">as</span> <span class="n">Physical</span> <span class="n">write</span> <span class="n">protected</span> <span class="n">attribute</span><span class="p">,</span> <span class="ow">and</span> <span class="n">EFI_RESOURCE_ATTRIBUTE_WRITE_PROTECTED</span>
<span class="o">//</span> <span class="n">means</span> <span class="n">Memory</span> <span class="n">cacheability</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">The</span> <span class="n">memory</span> <span class="n">supports</span> <span class="n">being</span> <span class="n">programmed</span> <span class="k">with</span>
<span class="o">//</span> <span class="n">a</span> <span class="n">writeprotected</span> <span class="n">cacheable</span> <span class="n">attribute</span><span class="o">.</span>
<span class="o">//</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_WRITE_PROTECTED          0x00000100</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_EXECUTION_PROTECTED      0x00000200</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_PERSISTENT               0x00800000</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">The</span> <span class="n">rest</span> <span class="n">of</span> <span class="n">the</span> <span class="n">attributes</span> <span class="n">are</span> <span class="n">used</span> <span class="n">to</span> <span class="n">describe</span> <span class="n">capabilities</span>
<span class="o">//</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_SINGLE_BIT_ECC           0x00000008</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_MULTIPLE_BIT_ECC         0x00000010</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_ECC_RESERVED_1           0x00000020</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_ECC_RESERVED_2           0x00000040</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_UNCACHEABLE              0x00000400</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_WRITE_COMBINEABLE        0x00000800</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_WRITE_THROUGH_CACHEABLE  0x00001000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_WRITE_BACK_CACHEABLE     0x00002000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_16_BIT_IO                0x00004000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_32_BIT_IO                0x00008000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_64_BIT_IO                0x00010000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_UNCACHED_EXPORTED        0x00020000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_READ_PROTECTABLE         0x00100000</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">typically</span> <span class="n">used</span> <span class="k">as</span> <span class="n">memory</span> <span class="n">cacheability</span> <span class="n">attribute</span> <span class="n">today</span><span class="o">.</span>
<span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Since</span> <span class="n">PI</span> <span class="n">spec</span> <span class="mf">1.4</span><span class="p">,</span> <span class="n">please</span> <span class="n">use</span> <span class="n">EFI_RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTABLE</span>
<span class="o">//</span> <span class="k">as</span> <span class="n">Memory</span> <span class="n">capability</span> <span class="n">attribute</span><span class="p">:</span> <span class="n">The</span> <span class="n">memory</span> <span class="n">supports</span> <span class="n">being</span> <span class="n">protected</span> <span class="kn">from</span> <span class="nn">processor</span>
<span class="o">//</span> <span class="n">writes</span><span class="p">,</span> <span class="ow">and</span> <span class="n">EFI_RESOURCE_ATTRIBUTE_WRITE_PROTEC</span> <span class="n">TABLE</span> <span class="n">means</span> <span class="n">Memory</span> <span class="n">cacheability</span> <span class="n">attribute</span><span class="p">:</span>
<span class="o">//</span> <span class="n">The</span> <span class="n">memory</span> <span class="n">supports</span> <span class="n">being</span> <span class="n">programmed</span> <span class="k">with</span> <span class="n">a</span> <span class="n">writeprotected</span> <span class="n">cacheable</span> <span class="n">attribute</span><span class="o">.</span>
<span class="o">//</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_WRITE_PROTECTABLE        0x00200000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_EXECUTION_PROTECTABLE    0x00400000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_PERSISTABLE              0x01000000</span>

<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTED      0x00040000</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTABLE    0x00080000</span>

<span class="o">//</span>
<span class="o">//</span> <span class="n">Physical</span> <span class="n">memory</span> <span class="n">relative</span> <span class="n">reliability</span> <span class="n">attribute</span><span class="o">.</span> <span class="n">This</span>
<span class="o">//</span> <span class="n">memory</span> <span class="n">provides</span> <span class="n">higher</span> <span class="n">reliability</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">other</span>
<span class="o">//</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">system</span><span class="o">.</span> <span class="n">If</span> <span class="nb">all</span> <span class="n">memory</span> <span class="n">has</span> <span class="n">the</span> <span class="n">same</span>
<span class="o">//</span> <span class="n">reliability</span><span class="p">,</span> <span class="n">then</span> <span class="n">this</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">used</span><span class="o">.</span>
<span class="o">//</span>
<span class="c1">#define EFI_RESOURCE_ATTRIBUTE_MORE_RELIABLE            0x02000000</span>
</pre></div>
</div>
</section>
<section id="efi-hob-resource-descriptor-1">
<span id="id9"></span><h4><span class="section-number">2.14.8.3. </span>EFI_HOB_RESOURCE_DESCRIPTOR<a class="headerlink" href="#efi-hob-resource-descriptor-1" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">Describes</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">properties</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">fixed</span><span class="p">,</span>
<span class="o">///</span> <span class="n">nonrelocatable</span> <span class="n">resource</span> <span class="n">ranges</span> <span class="n">found</span> <span class="n">on</span> <span class="n">the</span> <span class="n">processor</span>
<span class="o">///</span> <span class="n">host</span> <span class="n">bus</span> <span class="n">during</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producer</span> <span class="n">phase</span><span class="o">.</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">HOB</span> <span class="n">generic</span> <span class="n">header</span><span class="o">.</span> <span class="n">Header</span><span class="o">.</span><span class="n">HobType</span> <span class="o">=</span> <span class="n">EFI_HOB_TYPE_RESOURCE_DESCRIPTOR</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_HOB_GENERIC_HEADER</span>      <span class="n">Header</span><span class="p">;</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">A</span> <span class="n">GUID</span> <span class="n">representing</span> <span class="n">the</span> <span class="n">owner</span> <span class="n">of</span> <span class="n">the</span> <span class="n">resource</span><span class="o">.</span> <span class="n">This</span> <span class="n">GUID</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">by</span> <span class="n">HOB</span>
  <span class="o">///</span> <span class="n">consumer</span> <span class="n">phase</span> <span class="n">components</span> <span class="n">to</span> <span class="n">correlate</span> <span class="n">device</span> <span class="n">ownership</span> <span class="n">of</span> <span class="n">a</span> <span class="n">resource</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_GUID</span>                    <span class="n">Owner</span><span class="p">;</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">resource</span> <span class="nb">type</span> <span class="n">enumeration</span> <span class="k">as</span> <span class="n">defined</span> <span class="n">by</span> <span class="n">EFI_RESOURCE_TYPE</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_RESOURCE_TYPE</span>           <span class="n">ResourceType</span><span class="p">;</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Resource</span> <span class="n">attributes</span> <span class="k">as</span> <span class="n">defined</span> <span class="n">by</span> <span class="n">EFI_RESOURCE_ATTRIBUTE_TYPE</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_RESOURCE_ATTRIBUTE_TYPE</span> <span class="n">ResourceAttribute</span><span class="p">;</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">physical</span> <span class="n">start</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">region</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>        <span class="n">PhysicalStart</span><span class="p">;</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">region</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT64</span>                      <span class="n">ResourceLength</span><span class="p">;</span>
<span class="p">}</span> <span class="n">EFI_HOB_RESOURCE_DESCRIPTOR</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="efi-hob-memory-allocation">
<h3><span class="section-number">2.14.9. </span>EFI_HOB_MEMORY_ALLOCATION<a class="headerlink" href="#efi-hob-memory-allocation" title="Permalink to this heading">¶</a></h3>
<section id="efi-memory-type">
<h4><span class="section-number">2.14.9.1. </span>EFI_MEMORY_TYPE<a class="headerlink" href="#efi-memory-type" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Uefi/UefiMultiPhase.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Uefi/UefiMultiPhase.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">Enumeration</span> <span class="n">of</span> <span class="n">memory</span> <span class="n">types</span> <span class="n">introduced</span> <span class="ow">in</span> <span class="n">UEFI</span><span class="o">.</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">enum</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Not</span> <span class="n">used</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiReservedMemoryType</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">code</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">a</span> <span class="n">loaded</span> <span class="n">application</span><span class="o">.</span>
  <span class="o">///</span> <span class="p">(</span><span class="n">Note</span> <span class="n">that</span> <span class="n">UEFI</span> <span class="n">OS</span> <span class="n">loaders</span> <span class="n">are</span> <span class="n">UEFI</span> <span class="n">applications</span><span class="o">.</span><span class="p">)</span>
  <span class="o">///</span>
  <span class="n">EfiLoaderCode</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">data</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">a</span> <span class="n">loaded</span> <span class="n">application</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">default</span> <span class="n">data</span> <span class="n">allocation</span>
  <span class="o">///</span> <span class="nb">type</span> <span class="n">used</span> <span class="n">by</span> <span class="n">an</span> <span class="n">application</span> <span class="n">to</span> <span class="n">allocate</span> <span class="n">pool</span> <span class="n">memory</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiLoaderData</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">code</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">a</span> <span class="n">loaded</span> <span class="n">Boot</span> <span class="n">Services</span> <span class="n">Driver</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiBootServicesCode</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">data</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">a</span> <span class="n">loaded</span> <span class="n">Boot</span> <span class="n">Serves</span> <span class="n">Driver</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">default</span> <span class="n">data</span>
  <span class="o">///</span> <span class="n">allocation</span> <span class="nb">type</span> <span class="n">used</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Boot</span> <span class="n">Services</span> <span class="n">Driver</span> <span class="n">to</span> <span class="n">allocate</span> <span class="n">pool</span> <span class="n">memory</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiBootServicesData</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">code</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">a</span> <span class="n">loaded</span> <span class="n">Runtime</span> <span class="n">Services</span> <span class="n">Driver</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiRuntimeServicesCode</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">data</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">a</span> <span class="n">loaded</span> <span class="n">Runtime</span> <span class="n">Services</span> <span class="n">Driver</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">default</span>
  <span class="o">///</span> <span class="n">data</span> <span class="n">allocation</span> <span class="nb">type</span> <span class="n">used</span> <span class="n">by</span> <span class="n">a</span> <span class="n">Runtime</span> <span class="n">Services</span> <span class="n">Driver</span> <span class="n">to</span> <span class="n">allocate</span> <span class="n">pool</span> <span class="n">memory</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiRuntimeServicesData</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Free</span> <span class="p">(</span><span class="n">unallocated</span><span class="p">)</span> <span class="n">memory</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiConventionalMemory</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Memory</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">errors</span> <span class="n">have</span> <span class="n">been</span> <span class="n">detected</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiUnusableMemory</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Memory</span> <span class="n">that</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">ACPI</span> <span class="n">tables</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiACPIReclaimMemory</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Address</span> <span class="n">space</span> <span class="n">reserved</span> <span class="k">for</span> <span class="n">use</span> <span class="n">by</span> <span class="n">the</span> <span class="n">firmware</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiACPIMemoryNVS</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Used</span> <span class="n">by</span> <span class="n">system</span> <span class="n">firmware</span> <span class="n">to</span> <span class="n">request</span> <span class="n">that</span> <span class="n">a</span> <span class="n">memory</span><span class="o">-</span><span class="n">mapped</span> <span class="n">IO</span> <span class="n">region</span>
  <span class="o">///</span> <span class="n">be</span> <span class="n">mapped</span> <span class="n">by</span> <span class="n">the</span> <span class="n">OS</span> <span class="n">to</span> <span class="n">a</span> <span class="n">virtual</span> <span class="n">address</span> <span class="n">so</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">accessed</span> <span class="n">by</span> <span class="n">EFI</span> <span class="n">runtime</span> <span class="n">services</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiMemoryMappedIO</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">System</span> <span class="n">memory</span><span class="o">-</span><span class="n">mapped</span> <span class="n">IO</span> <span class="n">region</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">to</span> <span class="n">translate</span> <span class="n">memory</span>
  <span class="o">///</span> <span class="n">cycles</span> <span class="n">to</span> <span class="n">IO</span> <span class="n">cycles</span> <span class="n">by</span> <span class="n">the</span> <span class="n">processor</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiMemoryMappedIOPortSpace</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Address</span> <span class="n">space</span> <span class="n">reserved</span> <span class="n">by</span> <span class="n">the</span> <span class="n">firmware</span> <span class="k">for</span> <span class="n">code</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">part</span> <span class="n">of</span> <span class="n">the</span> <span class="n">processor</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiPalCode</span><span class="p">,</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">A</span> <span class="n">memory</span> <span class="n">region</span> <span class="n">that</span> <span class="n">operates</span> <span class="k">as</span> <span class="n">EfiConventionalMemory</span><span class="p">,</span>
  <span class="o">///</span> <span class="n">however</span> <span class="n">it</span> <span class="n">happens</span> <span class="n">to</span> <span class="n">also</span> <span class="n">support</span> <span class="n">byte</span><span class="o">-</span><span class="n">addressable</span> <span class="n">non</span><span class="o">-</span><span class="n">volatility</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EfiPersistentMemory</span><span class="p">,</span>
  <span class="n">EfiMaxMemoryType</span>
<span class="p">}</span> <span class="n">EFI_MEMORY_TYPE</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="efi-hob-memory-allocation-header">
<h4><span class="section-number">2.14.9.2. </span>EFI_HOB_MEMORY_ALLOCATION_HEADER<a class="headerlink" href="#efi-hob-memory-allocation-header" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">EFI_HOB_MEMORY_ALLOCATION_HEADER</span> <span class="n">describes</span> <span class="n">the</span>
<span class="o">///</span> <span class="n">various</span> <span class="n">attributes</span> <span class="n">of</span> <span class="n">the</span> <span class="n">logical</span> <span class="n">memory</span> <span class="n">allocation</span><span class="o">.</span> <span class="n">The</span> <span class="nb">type</span> <span class="n">field</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span>
<span class="o">///</span> <span class="n">subsequent</span> <span class="n">inclusion</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">UEFI</span> <span class="n">memory</span> <span class="nb">map</span><span class="o">.</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">A</span> <span class="n">GUID</span> <span class="n">that</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">memory</span> <span class="n">allocation</span> <span class="n">region</span><span class="s1">&#39;s type and purpose, as well as</span>
  <span class="o">///</span> <span class="n">other</span> <span class="n">fields</span> <span class="n">within</span> <span class="n">the</span> <span class="n">memory</span> <span class="n">allocation</span> <span class="n">HOB</span><span class="o">.</span> <span class="n">This</span> <span class="n">GUID</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">to</span> <span class="n">define</span> <span class="n">the</span>
  <span class="o">///</span> <span class="n">additional</span> <span class="n">data</span> <span class="n">within</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">that</span> <span class="n">may</span> <span class="n">be</span> <span class="n">present</span> <span class="k">for</span> <span class="n">the</span> <span class="n">memory</span> <span class="n">allocation</span> <span class="n">HOB</span><span class="o">.</span>
  <span class="o">///</span> <span class="n">Type</span> <span class="n">EFI_GUID</span> <span class="ow">is</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">InstallProtocolInterface</span><span class="p">()</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">UEFI</span> <span class="mf">2.0</span>
  <span class="o">///</span> <span class="n">specification</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_GUID</span>              <span class="n">Name</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">base</span> <span class="n">address</span> <span class="n">of</span> <span class="n">memory</span> <span class="n">allocated</span> <span class="n">by</span> <span class="n">this</span> <span class="n">HOB</span><span class="o">.</span> <span class="n">Type</span>
  <span class="o">///</span> <span class="n">EFI_PHYSICAL_ADDRESS</span> <span class="ow">is</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">AllocatePages</span><span class="p">()</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">UEFI</span> <span class="mf">2.0</span>
  <span class="o">///</span> <span class="n">specification</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>  <span class="n">MemoryBaseAddress</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">memory</span> <span class="n">allocated</span> <span class="n">by</span> <span class="n">this</span> <span class="n">HOB</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">UINT64</span>                <span class="n">MemoryLength</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Defines</span> <span class="n">the</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">memory</span> <span class="n">allocated</span> <span class="n">by</span> <span class="n">this</span> <span class="n">HOB</span><span class="o">.</span> <span class="n">The</span> <span class="n">memory</span> <span class="nb">type</span> <span class="n">definition</span>
  <span class="o">///</span> <span class="n">follows</span> <span class="n">the</span> <span class="n">EFI_MEMORY_TYPE</span> <span class="n">definition</span><span class="o">.</span> <span class="n">Type</span> <span class="n">EFI_MEMORY_TYPE</span> <span class="ow">is</span> <span class="n">defined</span>
  <span class="o">///</span> <span class="ow">in</span> <span class="n">AllocatePages</span><span class="p">()</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">UEFI</span> <span class="mf">2.0</span> <span class="n">specification</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_MEMORY_TYPE</span>       <span class="n">MemoryType</span><span class="p">;</span>

  <span class="o">///</span>
  <span class="o">///</span> <span class="n">Padding</span> <span class="k">for</span> <span class="n">Itanium</span> <span class="n">processor</span> <span class="n">family</span>
  <span class="o">///</span>
  <span class="n">UINT8</span>                 <span class="n">Reserved</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span> <span class="n">EFI_HOB_MEMORY_ALLOCATION_HEADER</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="id10">
<h4><span class="section-number">2.14.9.3. </span>EFI_HOB_MEMORY_ALLOCATION<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Pi/PiHob.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">///</span>
<span class="o">///</span> <span class="n">Describes</span> <span class="nb">all</span> <span class="n">memory</span> <span class="n">ranges</span> <span class="n">used</span> <span class="n">during</span> <span class="n">the</span> <span class="n">HOB</span> <span class="n">producer</span>
<span class="o">///</span> <span class="n">phase</span> <span class="n">that</span> <span class="n">exist</span> <span class="n">outside</span> <span class="n">the</span> <span class="n">HOB</span> <span class="nb">list</span><span class="o">.</span> <span class="n">This</span> <span class="n">HOB</span> <span class="nb">type</span>
<span class="o">///</span> <span class="n">describes</span> <span class="n">how</span> <span class="n">memory</span> <span class="ow">is</span> <span class="n">used</span><span class="p">,</span> <span class="ow">not</span> <span class="n">the</span> <span class="n">physical</span> <span class="n">attributes</span> <span class="n">of</span> <span class="n">memory</span><span class="o">.</span>
<span class="o">///</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">The</span> <span class="n">HOB</span> <span class="n">generic</span> <span class="n">header</span><span class="o">.</span> <span class="n">Header</span><span class="o">.</span><span class="n">HobType</span> <span class="o">=</span> <span class="n">EFI_HOB_TYPE_MEMORY_ALLOCATION</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_HOB_GENERIC_HEADER</span>            <span class="n">Header</span><span class="p">;</span>
  <span class="o">///</span>
  <span class="o">///</span> <span class="n">An</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">the</span> <span class="n">EFI_HOB_MEMORY_ALLOCATION_HEADER</span> <span class="n">that</span> <span class="n">describes</span> <span class="n">the</span>
  <span class="o">///</span> <span class="n">various</span> <span class="n">attributes</span> <span class="n">of</span> <span class="n">the</span> <span class="n">logical</span> <span class="n">memory</span> <span class="n">allocation</span><span class="o">.</span>
  <span class="o">///</span>
  <span class="n">EFI_HOB_MEMORY_ALLOCATION_HEADER</span>  <span class="n">AllocDescriptor</span><span class="p">;</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">Additional</span> <span class="n">data</span> <span class="n">pertaining</span> <span class="n">to</span> <span class="n">the</span> <span class="s2">&quot;Name&quot;</span> <span class="n">Guid</span> <span class="n">memory</span>
  <span class="o">//</span> <span class="n">may</span> <span class="n">go</span> <span class="n">here</span><span class="o">.</span>
  <span class="o">//</span>
<span class="p">}</span> <span class="n">EFI_HOB_MEMORY_ALLOCATION</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="future-interface">
<h2><span class="section-number">2.15. </span>Future Interface<a class="headerlink" href="#future-interface" title="Permalink to this heading">¶</a></h2>
<p>Currently, we are using HOB list as the Universal Payload Interface. However, HOB list has some limitations as below:</p>
<ol class="arabic simple">
<li><p>Hob is an implementation of Edk2, and defined in PI spec. This may be not friendly to non-Edk2 developers.</p></li>
<li><p>Some hob structures contain fields which are only meaningful for Edk2 DXE phase. These fields are confusing.</p></li>
<li><p>Hob can contain not only the data transferred to the next phase but also the data used in the current phase. There is no clear boundary of them.</p></li>
<li><p>Not a self-describing data format.</p></li>
</ol>
<p>In the future, we plan to use another data format CBOR or FDT to replace Hob.</p>
<section id="cbor-encoded-data">
<h3><span class="section-number">2.15.1. </span>CBOR encoded data<a class="headerlink" href="#cbor-encoded-data" title="Permalink to this heading">¶</a></h3>
<p>The bootloader should build Concise Binary Object Representation (CBOR) encoded data
and pass the CBOR encoded data header to payload when passing control to payload.
CBOR is a binary data serialization Json-like
format defined in the <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc8949.html">https://www.rfc-editor.org/rfc/rfc8949.html</a></p>
<p>To be self-describing, the CBOR encoded data itself is a CBOR map type containing
&lt;Key, Value&gt; pairs. The map is called CBOR root map in this document.
Some of the values called basic type are directly stored into the root map, and the
key and value type are stored in key and type column of the below table.
Some of the values called special type need to be stored in a submap of an array,
because there may be multiple instances of the values. For these kinds of value,
The key for array is stored in the key column, and the key and type for the value
are stored in in Submap key and type column. For example, the value in root map
with key “UplExtraData” is a CBOR format array, and the array contains one or more elements.
Each element is a CBOR format map, and contains some &lt;Key, value&gt; pairs, and the Key can
be “Identifier”, “Base” and “Size” according to the below table.</p>
<p>The below table shows what information can be contained in CBOR encoded data.</p>
<p><strong>Fields inside CBOR encoded data</strong></p>
<p>Because CBOR has different types compared with C language, the below table lists the C type and CBOR type for each field.
For example, we have UINT8, UINT32, UINT64 in C language for unsigned integer, but in CBOR type, Unsigned Integer can cover all
unsigned integer from 0 to 2^64 - 1.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Submap Key</p></th>
<th class="head"><p>C Type</p></th>
<th class="head"><p>CBOR Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SerialPortUseMmio</p></td>
<td></td>
<td><p>BOOLEAN</p></td>
<td><p>BOOLEAN</p></td>
</tr>
<tr class="row-odd"><td><p>SerialPortRegisterStride</p></td>
<td></td>
<td><p>UINT8</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>SerialPortBaudRate</p></td>
<td></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>SerialPortRegisterBase</p></td>
<td></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>RootBridgeResourceAssigned</p></td>
<td></td>
<td><p>BOOLEAN</p></td>
<td><p>BOOLEAN</p></td>
</tr>
<tr class="row-odd"><td><p>SmBiosTableEntryPoint</p></td>
<td></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>AcpiTableRsdp</p></td>
<td></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>GraphicsFrameBufferBase</p></td>
<td></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>GraphicsFrameBufferSize</p></td>
<td></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>GraphicsHorizontalResolution</p></td>
<td></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>GraphicsVerticalResolution</p></td>
<td></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>GraphicsPixelFormat</p></td>
<td></td>
<td><p>UINT8</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>GraphicsPixelInformationRedMask</p></td>
<td></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>GraphicsPixelInformationGreenMask</p></td>
<td></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>GraphicsPixelInformationBlueMask</p></td>
<td></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>GraphicsVendorId</p></td>
<td></td>
<td><p>UINT16</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>GraphicsDeviceId</p></td>
<td></td>
<td><p>UINT16</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>GraphicsSubsystemVendorId</p></td>
<td></td>
<td><p>UINT16</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>GraphicsSubsystemId</p></td>
<td></td>
<td><p>UINT16</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>GraphicsRevisionId</p></td>
<td></td>
<td><p>UINT8</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>GraphicsBarIndex</p></td>
<td></td>
<td><p>UINT8</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>MemorySpace</p></td>
<td></td>
<td><p>UINT8</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>IoSpace</p></td>
<td></td>
<td><p>UINT8</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>UplExtraData</p></td>
<td><p>Identifier</p></td>
<td><p>CHAR*</p></td>
<td><p>STRING</p></td>
</tr>
<tr class="row-even"><td><p>Base</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>Size</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td rowspan="26"><p>RootBridgeInfo</p></td>
<td><p>Segment</p></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>Supports</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>Attribute</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>DmaAbove4G</p></td>
<td><p>BOOLEAN</p></td>
<td><p>BOOLEAN</p></td>
</tr>
<tr class="row-even"><td><p>NoExtendedConfigSpace</p></td>
<td><p>BOOLEAN</p></td>
<td><p>BOOLEAN</p></td>
</tr>
<tr class="row-odd"><td><p>AllocationAttributes</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>BusBase</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>BusLimit</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>BusTranslation</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>IoBase</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>IoLimit</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>IoTranslation</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>MemBase</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>MemLimit</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>MemTranslation</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>MemAbove4GBase</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>MemAbove4GLimit</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>MemAbove4GTranslation</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>PMemBase</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>PMemLimit</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>PMemTranslation</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>PMemAbove4GBase</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>PMemAbove4GLimit</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>PMemAbove4GTranslation</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>HID</p></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>UID</p></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td rowspan="5"><p>Resource</p></td>
<td><p>Owner</p></td>
<td><p>CHAR*</p></td>
<td><p>STRING</p></td>
</tr>
<tr class="row-odd"><td><p>Type</p></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>Attribute</p></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>Base</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>Length</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td rowspan="4"><p>ResourceAllocation</p></td>
<td><p>Name</p></td>
<td><p>STRING</p></td>
<td><p>STRING</p></td>
</tr>
<tr class="row-even"><td><p>Base</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>Length</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>Type</p></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td rowspan="4"><p>MemoryMap</p></td>
<td><p>Base</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>NumberOfPages</p></td>
<td><p>UINT64</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-odd"><td><p>Type</p></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
<tr class="row-even"><td><p>Attribute</p></td>
<td><p>UINT32</p></td>
<td><p>Unsigned Integer</p></td>
</tr>
</tbody>
</table>
<p>Here is the description of the fields.</p>
<p><code class="docutils literal notranslate"><span class="pre">SerialPortUseMmio</span></code></p>
<p>Indicates the 16550 serial port registers are in MMIO space, or in I/O space.</p>
<p><code class="docutils literal notranslate"><span class="pre">SerialPortRegisterStride</span></code></p>
<p>Indicates the number of bytes between registers.</p>
<p><code class="docutils literal notranslate"><span class="pre">SerialPortBaudRate</span></code></p>
<p>Baud rate for the 16550 compatible serial port.</p>
<p>It could be 921600, 460800, 230400, 115200, 57600, 38400, 19200,
9600, 7200, 4800, 3600, 2400, 2000, 1800, 1200, 600, 300, 150, 134,
110, 75, 50</p>
<p>Set to 0 to use the default baud rate 115200.</p>
<p><code class="docutils literal notranslate"><span class="pre">SerialPortRegisterBase</span></code></p>
<p>Base address of 16550 serial port registers in MMIO or I/O space.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridgeResourceAssigned</span></code></p>
<p>Bus/IO/MMIO resources for all root bridges have been assigned when it’s TRUE.</p>
<p><code class="docutils literal notranslate"><span class="pre">SmBiosTableEntryPoint</span></code></p>
<p>Points to the SMBIOS table</p>
<p><code class="docutils literal notranslate"><span class="pre">AcpiTableRsdp</span></code></p>
<p>Points to the ACPI RSDP table. The ACPI table need to follow ACPI specification version 2.0 or above.</p>
<p><code class="docutils literal notranslate"><span class="pre">GraphicsFrameBufferBase</span></code> and <code class="docutils literal notranslate"><span class="pre">GraphicsFrameBufferSize</span></code></p>
<p>Provide graphic frame buffer’s base and size</p>
<p><code class="docutils literal notranslate"><span class="pre">GraphicsHorizontalResolution</span></code> and <code class="docutils literal notranslate"><span class="pre">GraphicsVerticalResolution</span></code></p>
<p>The size of video screen in pixels in the X dimension and Y dimension.</p>
<p><code class="docutils literal notranslate"><span class="pre">GraphicsPixelFormat</span></code></p>
<p>Enumeration that defines the physical format of the pixel. A value of PixelBltOnly
implies that a linear frame buffer is not available for this mode. More information
can be seen from below sample code</p>
<blockquote>
<div><div class="line-block">
<div class="line">typedef enum {</div>
<div class="line-block">
<div class="line">///</div>
<div class="line">/// A pixel is 32-bits and byte zero represents red, byte one represents green,</div>
<div class="line">/// byte two represents blue, and byte three is reserved. This is the definition</div>
<div class="line">/// for the physical frame buffer. The byte values for the red, green, and blue</div>
<div class="line">/// components represent the color intensity. This color intensity value range</div>
<div class="line">/// from a minimum intensity of 0 to maximum intensity of 255.</div>
<div class="line">///</div>
<div class="line">PixelRedGreenBlueReserved8BitPerColor,</div>
<div class="line">///</div>
<div class="line">/// A pixel is 32-bits and byte zero represents blue, byte one represents green,</div>
<div class="line">/// byte two represents red, and byte three is reserved. This is the definition</div>
<div class="line">/// for the physical frame buffer. The byte values for the red, green, and blue</div>
<div class="line">/// components represent the color intensity. This color intensity value range</div>
<div class="line">/// from a minimum intensity of 0 to maximum intensity of 255.</div>
<div class="line">///</div>
<div class="line">PixelBlueGreenRedReserved8BitPerColor,</div>
<div class="line">///</div>
<div class="line">/// The Pixel definition of the physical frame buffer.</div>
<div class="line">///</div>
<div class="line">PixelBitMask,</div>
<div class="line">///</div>
<div class="line">/// This mode does not support a physical frame buffer.</div>
<div class="line">///</div>
<div class="line">PixelBltOnly,</div>
<div class="line">///</div>
<div class="line">/// Valid EFI_GRAPHICS_PIXEL_FORMAT enum values are less than this value.</div>
<div class="line">///</div>
<div class="line">PixelFormatMax</div>
</div>
<div class="line">} EFI_GRAPHICS_PIXEL_FORMAT;</div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">GraphicsPixelInformationRedMask</span></code>, <code class="docutils literal notranslate"><span class="pre">GraphicsPixelInformationGreenMask</span></code> and <code class="docutils literal notranslate"><span class="pre">GraphicsPixelInformationBlueMask</span></code></p>
<p>A bit being set defines what bits are used for what purpose such as Red, Green, Blue, or Reserved.</p>
<p><code class="docutils literal notranslate"><span class="pre">GraphicsVendorId</span></code>, <code class="docutils literal notranslate"><span class="pre">GraphicsDeviceId</span></code>, <code class="docutils literal notranslate"><span class="pre">GraphicsSubsystemVendorId</span></code>, <code class="docutils literal notranslate"><span class="pre">GraphicsSubsystemId</span></code>, <code class="docutils literal notranslate"><span class="pre">GraphicsRevisionId</span></code>, and <code class="docutils literal notranslate"><span class="pre">GraphicsBarIndex</span></code></p>
<p>Define the Graphics device hardware information.</p>
<p><code class="docutils literal notranslate"><span class="pre">MemorySpace</span></code> and <code class="docutils literal notranslate"><span class="pre">IoSpace</span></code></p>
<p>Provide information about the address space and I/O space</p>
<p><code class="docutils literal notranslate"><span class="pre">UplExtraData</span></code></p>
<p>Contains one or more extra binaries. Each binary has its <code class="docutils literal notranslate"><span class="pre">Identifier</span></code>, <code class="docutils literal notranslate"><span class="pre">Base</span></code> and <code class="docutils literal notranslate"><span class="pre">Size</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridgeInfo</span></code></p>
<p>Contains one or more root bridge information. For each root bridge, it contains below fields.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Segment</span></code></div>
<div class="line"><br /></div>
<div class="line">Segment number of the root bridge.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Supports</span></code></div>
<div class="line"><br /></div>
<div class="line">Supported attributes. Refer to EFI_PCI_ATTRIBUTE_xxx used by GetAttributes() and SetAttributes() in EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL</div>
<div class="line">defined in PI Specification.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">Attributes</span></code></div>
<div class="line"><br /></div>
<div class="line">Initial attributes. Refer to EFI_PCI_ATTRIBUTE_xxx used by GetAttributes() and SetAttributes() in EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL</div>
<div class="line">defined in PI Specification.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">DmaAbove4G</span></code></div>
<div class="line"><br /></div>
<div class="line">Root bridge supports DMA above 4GB memory when it’s TRUE.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">NoExtendedConfigSpace</span></code></div>
<div class="line"><br /></div>
<div class="line">Root bridge supports 256-byte configuration space only when it’s TRUE.</div>
<div class="line">Root bridge supports 4K-byte configuration space when it’s FALSE.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">AllocationAttributes</span></code></div>
<div class="line"><br /></div>
<div class="line">Allocation attributes. Refer to EFI_PCI_HOST_BRIDGE_COMBINE_MEM_PMEM and EFI_PCI_HOST_BRIDGE_MEM64_DECODE used by GetAllocAttributes()</div>
<div class="line">in EFI_PCI_HOST_BRIDGE_RESOURCE_ALLOCATION_PROTOCOL defined in PI Specification.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">BusBase</span></code>, <code class="docutils literal notranslate"><span class="pre">BusLimit</span></code>, and <code class="docutils literal notranslate"><span class="pre">BusTranslation</span></code></div>
<div class="line"><br /></div>
<div class="line">Bus aperture for the root bridge.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">IoBase</span></code>, <code class="docutils literal notranslate"><span class="pre">IoLimit</span></code>, and <code class="docutils literal notranslate"><span class="pre">IoTranslation</span></code></div>
<div class="line"><br /></div>
<div class="line">IO aperture for the root bridge.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">MemBase</span></code>, <code class="docutils literal notranslate"><span class="pre">IoLimit</span></code>, and <code class="docutils literal notranslate"><span class="pre">IoTranslation</span></code></div>
<div class="line"><br /></div>
<div class="line">MMIO aperture below 4GB for the root bridge.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">MemAbove4GBase</span></code>, <code class="docutils literal notranslate"><span class="pre">MemAbove4GBaseLimit</span></code> and <code class="docutils literal notranslate"><span class="pre">MemAbove4GBaseTranslation</span></code></div>
<div class="line"><br /></div>
<div class="line">MMIO aperture above 4GB for the root bridge.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">PMemBase</span></code>, <code class="docutils literal notranslate"><span class="pre">PMemLimit</span></code> and <code class="docutils literal notranslate"><span class="pre">PMemTranslation</span></code></div>
<div class="line"><br /></div>
<div class="line">Prefetchable MMIO aperture below 4GB for the root bridge.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">PMemAbove4GBase</span></code>, <code class="docutils literal notranslate"><span class="pre">PMemAbove4GLimit</span></code> and <code class="docutils literal notranslate"><span class="pre">PMemAbove4GTranslation</span></code></div>
<div class="line"><br /></div>
<div class="line">Prefetchable MMIO aperture above 4GB for the root bridge.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">HID</span></code></div>
<div class="line"><br /></div>
<div class="line">PnP hardware ID of the root bridge. This value must match the corresponding _HID in the ACPI name space.</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">UID</span></code></div>
<div class="line"><br /></div>
<div class="line">Unique ID that is required by ACPI if two devices have the same _HID. This value must also match the corresponding _UID/_HID pair in the ACPI name space.</div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Resource</span></code></p>
<p>Contains one or more Resource Descriptor. The base and size of the resource can be
known from <code class="docutils literal notranslate"><span class="pre">Base</span></code> and <code class="docutils literal notranslate"><span class="pre">Length</span></code>. <code class="docutils literal notranslate"><span class="pre">Owner</span></code> can be used optionally to indicate the resource purpose.
The meaning of <code class="docutils literal notranslate"><span class="pre">Type</span></code> can be seen from below sample code</p>
<blockquote>
<div><div class="line-block">
<div class="line">#define EFI_RESOURCE_SYSTEM_MEMORY          0x00000000</div>
<div class="line">#define EFI_RESOURCE_MEMORY_MAPPED_IO       0x00000001</div>
<div class="line">#define EFI_RESOURCE_IO                     0x00000002</div>
<div class="line">#define EFI_RESOURCE_FIRMWARE_DEVICE        0x00000003</div>
<div class="line">#define EFI_RESOURCE_MEMORY_MAPPED_IO_PORT  0x00000004</div>
<div class="line">#define EFI_RESOURCE_MEMORY_RESERVED        0x00000005</div>
<div class="line">#define EFI_RESOURCE_IO_RESERVED            0x00000006</div>
<div class="line">#define EFI_RESOURCE_MAX_MEMORY_TYPE        0x00000007</div>
</div>
</div></blockquote>
<p>The meaning of <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> can be seen from below sample code</p>
<blockquote>
<div><div class="line-block">
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_PRESENT         0x00000001</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_INITIALIZED     0x00000002</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_TESTED          0x00000004</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_READ_PROTECTED  0x00000080</div>
<div class="line">//</div>
<div class="line">// This is typically used as memory cacheability attribute today.</div>
<div class="line">// NOTE: Since PI spec 1.4, please use EFI_RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTED</div>
<div class="line">// as Physical write protected attribute, and EFI_RESOURCE_ATTRIBUTE_WRITE_PROTECTED</div>
<div class="line">// means Memory cacheability attribute: The memory supports being programmed with</div>
<div class="line">// a writeprotected cacheable attribute.</div>
<div class="line">//</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_WRITE_PROTECTED      0x00000100</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_EXECUTION_PROTECTED  0x00000200</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_PERSISTENT           0x00800000</div>
<div class="line">//</div>
<div class="line">// The rest of the attributes are used to describe capabilities</div>
<div class="line">//</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_SINGLE_BIT_ECC           0x00000008</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_MULTIPLE_BIT_ECC         0x00000010</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_ECC_RESERVED_1           0x00000020</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_ECC_RESERVED_2           0x00000040</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_UNCACHEABLE              0x00000400</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_WRITE_COMBINEABLE        0x00000800</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_WRITE_THROUGH_CACHEABLE  0x00001000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_WRITE_BACK_CACHEABLE     0x00002000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_16_BIT_IO                0x00004000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_32_BIT_IO                0x00008000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_64_BIT_IO                0x00010000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_UNCACHED_EXPORTED        0x00020000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_READ_PROTECTABLE         0x00100000</div>
<div class="line">//</div>
<div class="line">// This is typically used as memory cacheability attribute today.</div>
<div class="line">// NOTE: Since PI spec 1.4, please use EFI_RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTABLE</div>
<div class="line">// as Memory capability attribute: The memory supports being protected from processor</div>
<div class="line">// writes, and EFI_RESOURCE_ATTRIBUTE_WRITE_PROTEC TABLE means Memory cacheability attribute:</div>
<div class="line">// The memory supports being programmed with a writeprotected cacheable attribute.</div>
<div class="line">//</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_WRITE_PROTECTABLE      0x00200000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_EXECUTION_PROTECTABLE  0x00400000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_PERSISTABLE            0x01000000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTED    0x00040000</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTABLE  0x00080000</div>
<div class="line">//</div>
<div class="line">// Physical memory relative reliability attribute. This</div>
<div class="line">// memory provides higher reliability relative to other</div>
<div class="line">// memory in the system. If all memory has the same</div>
<div class="line">// reliability, then this bit is not used.</div>
<div class="line">//</div>
<div class="line">#define EFI_RESOURCE_ATTRIBUTE_MORE_RELIABLE  0x02000000</div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ResourceAllocation</span></code></p>
<p>Contains one or more Resource Allocation ranges. It records which ranges
in the above <code class="docutils literal notranslate"><span class="pre">Resource</span></code> are used. The base and size of the used resource can be
known from <code class="docutils literal notranslate"><span class="pre">Base</span></code> and <code class="docutils literal notranslate"><span class="pre">Length</span></code>.
<code class="docutils literal notranslate"><span class="pre">Type</span></code> definition can be seen from below</p>
<blockquote>
<div><div class="line-block">
<div class="line">typedef enum {</div>
<div class="line-block">
<div class="line">///</div>
<div class="line">/// Not used.</div>
<div class="line">///</div>
<div class="line">EfiReservedMemoryType,</div>
<div class="line">///</div>
<div class="line">/// The code portions of a loaded application.</div>
<div class="line">/// (Note that UEFI OS loaders are UEFI applications.)</div>
<div class="line">///</div>
<div class="line">EfiLoaderCode,</div>
<div class="line">///</div>
<div class="line">/// The data portions of a loaded application and the default data allocation</div>
<div class="line">/// type used by an application to allocate pool memory.</div>
<div class="line">///</div>
<div class="line">EfiLoaderData,</div>
<div class="line">///</div>
<div class="line">/// The code portions of a loaded Boot Services Driver.</div>
<div class="line">///</div>
<div class="line">EfiBootServicesCode,</div>
<div class="line">///</div>
<div class="line">/// The data portions of a loaded Boot Serves Driver, and the default data</div>
<div class="line">/// allocation type used by a Boot Services Driver to allocate pool memory.</div>
<div class="line">///</div>
<div class="line">EfiBootServicesData,</div>
<div class="line">///</div>
<div class="line">/// The code portions of a loaded Runtime Services Driver.</div>
<div class="line">///</div>
<div class="line">EfiRuntimeServicesCode,</div>
<div class="line">///</div>
<div class="line">/// The data portions of a loaded Runtime Services Driver and the default</div>
<div class="line">/// data allocation type used by a Runtime Services Driver to allocate pool memory.</div>
<div class="line">///</div>
<div class="line">EfiRuntimeServicesData,</div>
<div class="line">///</div>
<div class="line">/// Free (unallocated) memory.</div>
<div class="line">///</div>
<div class="line">EfiConventionalMemory,</div>
<div class="line">///</div>
<div class="line">/// Memory in which errors have been detected.</div>
<div class="line">///</div>
<div class="line">EfiUnusableMemory,</div>
<div class="line">///</div>
<div class="line">/// Memory that holds the ACPI tables.</div>
<div class="line">///</div>
<div class="line">EfiACPIReclaimMemory,</div>
<div class="line">///</div>
<div class="line">/// Address space reserved for use by the firmware.</div>
<div class="line">///</div>
<div class="line">EfiACPIMemoryNVS,</div>
<div class="line">///</div>
<div class="line">/// Used by system firmware to request that a memory-mapped IO region</div>
<div class="line">/// be mapped by the OS to a virtual address so it can be accessed by EFI runtime services.</div>
<div class="line">///</div>
<div class="line">EfiMemoryMappedIO,</div>
<div class="line">///</div>
<div class="line">/// System memory-mapped IO region that is used to translate memory</div>
<div class="line">/// cycles to IO cycles by the processor.</div>
<div class="line">///</div>
<div class="line">EfiMemoryMappedIOPortSpace,</div>
<div class="line">///</div>
<div class="line">/// Address space reserved by the firmware for code that is part of the processor.</div>
<div class="line">///</div>
<div class="line">EfiPalCode,</div>
<div class="line">///</div>
<div class="line">/// A memory region that operates as EfiConventionalMemory,</div>
<div class="line">/// however it happens to also support byte-addressable non-volatility.</div>
<div class="line">///</div>
<div class="line">EfiPersistentMemory,</div>
<div class="line">EfiMaxMemoryType</div>
</div>
<div class="line">} EFI_MEMORY_TYPE;</div>
</div>
</div></blockquote>
<p>The above two fields are only used to record the MMIO and IO resource and usage.
For physical memory resource and usage, use the below field.</p>
<p><code class="docutils literal notranslate"><span class="pre">MemoryMap</span></code></p>
<p>Contains one or more physical memory ranges. The base and size of the memory range can be
known from <code class="docutils literal notranslate"><span class="pre">Base</span></code> and <code class="docutils literal notranslate"><span class="pre">NumberOfPages</span></code>.
The meaning of <code class="docutils literal notranslate"><span class="pre">Type</span></code> is same with the <code class="docutils literal notranslate"><span class="pre">ResourceAllocation</span></code>
The meaning of <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> can be seen from below sample code</p>
<blockquote>
<div><div class="line-block">
<div class="line">//</div>
<div class="line">// Memory cacheability attributes</div>
<div class="line">//</div>
<div class="line">#define EFI_MEMORY_UC   0x0000000000000001ULL</div>
<div class="line">#define EFI_MEMORY_WC   0x0000000000000002ULL</div>
<div class="line">#define EFI_MEMORY_WT   0x0000000000000004ULL</div>
<div class="line">#define EFI_MEMORY_WB   0x0000000000000008ULL</div>
<div class="line">#define EFI_MEMORY_UCE  0x0000000000000010ULL</div>
<div class="line">//</div>
<div class="line">// Physical memory protection attributes</div>
<div class="line">//</div>
<div class="line">// Note: UEFI spec 2.5 and following: use EFI_MEMORY_RO as write-protected physical memory</div>
<div class="line">// protection attribute. Also, EFI_MEMORY_WP means cacheability attribute.</div>
<div class="line">//</div>
<div class="line">#define EFI_MEMORY_WP  0x0000000000001000ULL</div>
<div class="line">#define EFI_MEMORY_RP  0x0000000000002000ULL</div>
<div class="line">#define EFI_MEMORY_XP  0x0000000000004000ULL</div>
<div class="line">#define EFI_MEMORY_RO  0x0000000000020000ULL</div>
<div class="line">//</div>
<div class="line">// Physical memory persistence attribute.</div>
<div class="line">// The memory region supports byte-addressable non-volatility.</div>
<div class="line">//</div>
<div class="line">#define EFI_MEMORY_NV  0x0000000000008000ULL</div>
<div class="line">//</div>
<div class="line">// The memory region provides higher reliability relative to other memory in the system.</div>
<div class="line">// If all memory has the same reliability, then this bit is not used.</div>
<div class="line">//</div>
<div class="line">#define EFI_MEMORY_MORE_RELIABLE  0x0000000000010000ULL</div>
<div class="line">//</div>
<div class="line">// Note: UEFI spec 2.8 and following:</div>
<div class="line">//</div>
<div class="line">// Specific-purpose memory (SPM). The memory is earmarked for</div>
<div class="line">// specific purposes such as for specific device drivers or applications.</div>
<div class="line">// The SPM attribute serves as a hint to the OS to avoid allocating this</div>
<div class="line">// memory for core OS data or code that can not be relocated.</div>
<div class="line">//</div>
<div class="line">#define EFI_MEMORY_SP  0x0000000000040000ULL</div>
<div class="line">//</div>
<div class="line">// If this flag is set, the memory region is capable of being</div>
<div class="line">// protected with the CPU’s memory cryptographic</div>
<div class="line">// capabilities. If this flag is clear, the memory region is not</div>
<div class="line">// capable of being protected with the CPU’s memory</div>
<div class="line">// cryptographic capabilities or the CPU does not support CPU</div>
<div class="line">// memory cryptographic capabilities.</div>
<div class="line">//</div>
<div class="line">#define EFI_MEMORY_CPU_CRYPTO  0x0000000000080000ULL</div>
<div class="line">//</div>
<div class="line">// Runtime memory attribute</div>
<div class="line">//</div>
<div class="line">#define EFI_MEMORY_RUNTIME  0x8000000000000000ULL</div>
</div>
</div></blockquote>
</section>
<section id="fdt-data-structure">
<h3><span class="section-number">2.15.2. </span>FDT data structure<a class="headerlink" href="#fdt-data-structure" title="Permalink to this heading">¶</a></h3>
<p>A devicetree is a tree data structure with nodes that describe the devices in a system.
Each node has exactly one parent except for the root node, which has no parent.
Each node has property/value pairs that describe the characteristics of the device being presented.
Properties consists of a name and a value. Property names are strings of 1 to 31 characters, property value is an array of zero or more bytes that contain information associated with the property.</p>
<p>The below tables show what nodes should be passed from bootloader and its corresponding property/value.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="mailto:memory&#37;&#52;&#48;#base">memory<span>&#64;</span>#base</a></p></td>
<td><p>device_type</p></td>
<td><p>memory</p></td>
<td></td>
</tr>
<tr class="row-odd"><td rowspan="2"></td>
<td><p>reg</p></td>
<td><p>&lt;base address, size&gt;</p></td>
<td><p>Specify system memory region range</p></td>
</tr>
<tr class="row-even"><td><p>attr</p></td>
<td><p>&lt;memory attribute&gt;</p></td>
<td><p>Refer to memory attributes definition below</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>SubNode</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>reserved-memory</p></td>
<td><p>#address-cells</p></td>
<td><p>2</p></td>
<td><p><a class="reference external" href="mailto:mmio&#37;&#52;&#48;#base">mmio<span>&#64;</span>#base</a></p></td>
<td><p>reg</p></td>
<td><p>&lt;base address, size&gt;</p></td>
<td><p>Specify mmio region of reserved memory</p></td>
</tr>
<tr class="row-odd"><td rowspan="4"></td>
<td><p>#size-cells</p></td>
<td><p>2</p></td>
<td></td>
<td><p>attr</p></td>
<td><p>&lt;memory attribute&gt;</p></td>
<td><p>Refer to memory attributes definition below</p></td>
</tr>
<tr class="row-even"><td rowspan="3"></td>
<td rowspan="3"></td>
<td><p><a class="reference external" href="mailto:reserved&#37;&#52;&#48;#base">reserved<span>&#64;</span>#base</a></p></td>
<td><p>reg</p></td>
<td><p>&lt;base address, size&gt;</p></td>
<td><p>Specify reserved memory range</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>attr</p></td>
<td><p>&lt;memory attribute&gt;</p></td>
<td><p>Refer to memory attributes definition below</p></td>
</tr>
<tr class="row-even"><td><p>uefi</p></td>
<td><p>reg</p></td>
<td><p>&lt;base address, size&gt;</p></td>
<td><p>Allocated &gt;64MB memory range for Payload.</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>SubNode</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>memory-allocation</p></td>
<td><p>#address-cells</p></td>
<td><p>2</p></td>
<td><p>&lt;AllocType&gt;&#64;#base</p></td>
<td><p>reg</p></td>
<td><p>&lt;base address, size&gt;</p></td>
<td><p>Refer to resource type definition below</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>#size-cells</p></td>
<td><p>2</p></td>
<td></td>
<td><p>attr</p></td>
<td><p>&lt;memory attribute&gt;</p></td>
<td><p>Refer to memory attributes definition below</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">memory</span> <span class="pre">attribute</span></code></p>
<blockquote>
<div><div class="line-block">
<div class="line">#define RESOURCE_ATTRIBUTE_PRESENT                  0x00000001</div>
<div class="line">#define RESOURCE_ATTRIBUTE_INITIALIZED              0x00000002</div>
<div class="line">#define RESOURCE_ATTRIBUTE_TESTED                   0x00000004</div>
<div class="line">#define RESOURCE_ATTRIBUTE_READ_PROTECTED           0x00000080</div>
<div class="line">#define RESOURCE_ATTRIBUTE_UNCACHEABLE              0x00000400</div>
<div class="line">#define RESOURCE_ATTRIBUTE_WRITE_COMBINEABLE        0x00000800</div>
<div class="line">#define RESOURCE_ATTRIBUTE_WRITE_THROUGH_CACHEABLE  0x00001000</div>
<div class="line">#define RESOURCE_ATTRIBUTE_WRITE_BACK_CACHEABLE     0x00002000</div>
<div class="line">#define RESOURCE_ATTRIBUTE_UNCACHED_EXPORTED        0x00020000</div>
<div class="line">#define RESOURCE_ATTRIBUTE_READ_ONLY_PROTECTABLE    0x00080000</div>
<div class="line">#define RESOURCE_ATTRIBUTE_READ_PROTECTABLE         0x00100000</div>
<div class="line">#define RESOURCE_ATTRIBUTE_WRITE_PROTECTABLE        0x00200000</div>
<div class="line">#define RESOURCE_ATTRIBUTE_EXECUTION_PROTECTABLE    0x00400000</div>
<div class="line">#define RESOURCE_ATTRIBUTE_PERSISTABLE              0x01000000</div>
<div class="line">#define RESOURCE_ATTRIBUTE_MORE_RELIABLE            0x02000000</div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">memory-allocation</span></code></p>
<p>Contains one or more Resource Descriptor. The base and size of the resource can be
known from <code class="docutils literal notranslate"><span class="pre">base</span> <span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">size</span></code>.The meaning of <code class="docutils literal notranslate"><span class="pre">AllocType</span></code> can be seen from below sample code</p>
<blockquote>
<div><div class="line-block">
<div class="line">typedef enum {</div>
<div class="line-block">
<div class="line">///</div>
<div class="line">/// Not used.</div>
<div class="line">///</div>
<div class="line">ReservedMemoryType,</div>
<div class="line">///</div>
<div class="line">/// The code portions of a loaded application.</div>
<div class="line">/// (Note that UEFI OS loaders are UEFI applications.)</div>
<div class="line">///</div>
<div class="line">LoaderCode,</div>
<div class="line">///</div>
<div class="line">/// The data portions of a loaded application and the default data allocation</div>
<div class="line">/// type used by an application to allocate pool memory.</div>
<div class="line">///</div>
<div class="line">LoaderData,</div>
<div class="line">///</div>
<div class="line">/// The code portions of a loaded Boot Services Driver.</div>
<div class="line">///</div>
<div class="line">BootServicesCode,</div>
<div class="line">///</div>
<div class="line">/// The data portions of a loaded Boot Serves Driver, and the default data</div>
<div class="line">/// allocation type used by a Boot Services Driver to allocate pool memory.</div>
<div class="line">///</div>
<div class="line">BootServicesData,</div>
<div class="line">///</div>
<div class="line">/// The code portions of a loaded Runtime Services Driver.</div>
<div class="line">///</div>
<div class="line">RuntimeServicesCode,</div>
<div class="line">///</div>
<div class="line">/// The data portions of a loaded Runtime Services Driver and the default</div>
<div class="line">/// data allocation type used by a Runtime Services Driver to allocate pool memory.</div>
<div class="line">///</div>
<div class="line">RuntimeServicesData,</div>
<div class="line">///</div>
<div class="line">/// Free (unallocated) memory.</div>
<div class="line">///</div>
<div class="line">ConventionalMemory,</div>
<div class="line">///</div>
<div class="line">/// Memory in which errors have been detected.</div>
<div class="line">///</div>
<div class="line">UnusableMemory,</div>
<div class="line">///</div>
<div class="line">/// Memory that holds the ACPI tables.</div>
<div class="line">///</div>
<div class="line">ACPIReclaimMemory,</div>
<div class="line">///</div>
<div class="line">/// Address space reserved for use by the firmware.</div>
<div class="line">///</div>
<div class="line">ACPIMemoryNVS,</div>
<div class="line">///</div>
<div class="line">/// Used by system firmware to request that a memory-mapped IO region</div>
<div class="line">/// be mapped by the OS to a virtual address so it can be accessed by EFI runtime services.</div>
<div class="line">///</div>
<div class="line">MemoryMappedIO,</div>
<div class="line">///</div>
<div class="line">/// System memory-mapped IO region that is used to translate memory</div>
<div class="line">/// cycles to IO cycles by the processor.</div>
<div class="line">///</div>
<div class="line">MemoryMappedIOPortSpace,</div>
<div class="line">///</div>
<div class="line">/// Address space reserved by the firmware for code that is part of the processor.</div>
<div class="line">///</div>
<div class="line">PalCode,</div>
<div class="line">///</div>
<div class="line">/// A memory region that operates as EfiConventionalMemory,</div>
<div class="line">/// however it happens to also support byte-addressable non-volatility.</div>
<div class="line">///</div>
<div class="line">PersistentMemory,</div>
<div class="line">MaxMemoryType</div>
</div>
<div class="line">} MEMORY_TYPE;</div>
</div>
</div></blockquote>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="mailto:serial&#37;&#52;&#48;#base">serial<span>&#64;</span>#base</a></p></td>
<td><p>mmio</p></td>
<td><p>&lt;boolean&gt;</p></td>
<td><p>Indicates the 16550 serial port registers are in MMIO space, or in I/O space</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"></td>
<td><p>stride</p></td>
<td><p>#number</p></td>
<td><p>Indicates the number of bytes between registers</p></td>
</tr>
<tr class="row-even"><td><p>current-speed</p></td>
<td><p>&lt;baud rate&gt;</p></td>
<td><p>Baud rate for the 16550 compatible serial port</p></td>
</tr>
<tr class="row-odd"><td><p>reg</p></td>
<td><p>&lt;base address, size&gt;</p></td>
<td><p>Base address of 16550 serial port registers in MMIO or I/O space</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>graphic-info</p></td>
<td><p>reg</p></td>
<td><p>&lt;base address, size&gt;</p></td>
<td><p>Provide graphic frame buffer’s base and size</p></td>
</tr>
<tr class="row-odd"><td rowspan="4"></td>
<td><p>resolution</p></td>
<td><p>&lt;#h-res, #v-res&gt;</p></td>
<td><p>The size of video screen in pixels in the X dimension and Y dimension</p></td>
</tr>
<tr class="row-even"><td><p>pixel-format</p></td>
<td><p>#number</p></td>
<td><p>Refer to pixel-format definition below</p></td>
</tr>
<tr class="row-odd"><td><p>pixel-mask</p></td>
<td><p>&lt;#red, #green, #blue&gt;</p></td>
<td><p>Refer to pixel-mask definition below</p></td>
</tr>
<tr class="row-even"><td><p>pixe-scanline</p></td>
<td><p>#number</p></td>
<td><p>Refer to pixel-scanline definition below</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">pixel-format</span></code></p>
<p>Enumeration that defines the physical format of the pixel. A value of PixelBltOnly
implies that a linear frame buffer is not available for this mode. More information
can be seen from below sample code</p>
<blockquote>
<div><div class="line-block">
<div class="line">typedef enum {</div>
<div class="line-block">
<div class="line">///</div>
<div class="line">/// A pixel is 32-bits and byte zero represents red, byte one represents green,</div>
<div class="line">/// byte two represents blue, and byte three is reserved. This is the definition</div>
<div class="line">/// for the physical frame buffer. The byte values for the red, green, and blue</div>
<div class="line">/// components represent the color intensity. This color intensity value range</div>
<div class="line">/// from a minimum intensity of 0 to maximum intensity of 255.</div>
<div class="line">///</div>
<div class="line">PixelRedGreenBlueReserved8BitPerColor,</div>
<div class="line">///</div>
<div class="line">/// A pixel is 32-bits and byte zero represents blue, byte one represents green,</div>
<div class="line">/// byte two represents red, and byte three is reserved. This is the definition</div>
<div class="line">/// for the physical frame buffer. The byte values for the red, green, and blue</div>
<div class="line">/// components represent the color intensity. This color intensity value range</div>
<div class="line">/// from a minimum intensity of 0 to maximum intensity of 255.</div>
<div class="line">///</div>
<div class="line">PixelBlueGreenRedReserved8BitPerColor,</div>
<div class="line">///</div>
<div class="line">/// The Pixel definition of the physical frame buffer.</div>
<div class="line">///</div>
<div class="line">PixelBitMask,</div>
<div class="line">///</div>
<div class="line">/// This mode does not support a physical frame buffer.</div>
<div class="line">///</div>
<div class="line">PixelBltOnly,</div>
<div class="line">///</div>
<div class="line">/// Valid EFI_GRAPHICS_PIXEL_FORMAT enum values are less than this value.</div>
<div class="line">///</div>
<div class="line">PixelFormatMax</div>
</div>
<div class="line">} EFI_GRAPHICS_PIXEL_FORMAT;</div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">pixel-mask</span></code></p>
<p>If a bit is set in <em>#red</em>, <em>#green</em>, or <em>#blue</em> then those bits of the pixel represent the
corresponding color. Bits in <em>RedMask</em>, <em>GreenMask</em>, <em>BlueMask</em> must not overlap bit positions.
The values for the red, green, and blue components in the bit mask represent the color
intensity. The color intensities must increase as the color values for each color mask increase with a
minimum intensity of all bits in a color mask clear to a maximum intensity of all bits in a color mask set.</p>
<p><code class="docutils literal notranslate"><span class="pre">pixel-scanline</span></code></p>
<p>Defines the number of pixel elements per video memory line.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cpu-info</p></td>
<td><p>memoryspace</p></td>
<td><p>#number</p></td>
<td><p>Identifies the maximum physical memory addressability of the processor</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>acpi</p></td>
<td><p>rsdp</p></td>
<td><p>&lt;base address&gt;</p></td>
<td><p>Points to ACPI RSDP table. The ACPI table need to follow ACPI specification version 2.0 or above</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>smbios</p></td>
<td><p>entry</p></td>
<td><p>&lt;base address&gt;</p></td>
<td><p>Points to smbios structure UNIVERSAL_PAYLOAD_SMBIOS_TABLE</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PayloadBase</p></td>
<td><p>entry</p></td>
<td><p>&lt;base address&gt;</p></td>
<td><p>Points to the base of uncompressed ELF image</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">entry</span></code></p>
<p>If UPL ELF is compressed and BL will decompress it to memory, then it will be memory base address, otherwise it could be Flash MMIO base address.</p>
<p>The below tables show what nodes may be passed from bootloader and its corresponding property/value.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>graphic-device</p></td>
<td><p>vendor-id</p></td>
<td><p>#number</p></td>
<td rowspan="6"><p>Define the Graphics device hardware information.</p></td>
</tr>
<tr class="row-odd"><td rowspan="5"></td>
<td><p>device-id</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-even"><td><p>subsystem-vendor-id</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-odd"><td><p>subsystem-id</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-even"><td><p>revision-id</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-odd"><td><p>bar-index</p></td>
<td><p>#number</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>SubNode</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>extra-data</p></td>
<td><p>count</p></td>
<td><p>#number</p></td>
<td><p><a class="reference external" href="mailto:entry&#37;&#52;&#48;#number">entry<span>&#64;</span>#number</a></p></td>
<td><p>#address-cells</p></td>
<td><p>2</p></td>
<td rowspan="4"><p>Contains one or more extra binaries.
Each binary has its Identifier, Base, and Size</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"></td>
<td rowspan="3"></td>
<td rowspan="3"></td>
<td></td>
<td><p>#size-cells</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>id</p></td>
<td><p>&lt;string&gt;</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>reg</p></td>
<td><p>&lt;base address, size&gt;</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BootManagerMenuFile</p></td>
<td><p>filename</p></td>
<td><p>&lt;string&gt;</p></td>
<td><p>Points to the file name GUID of the BootManagerMenuApp</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DebugPrintErrorLevel</p></td>
<td><p>errorlevel</p></td>
<td><p>#number</p></td>
<td><p>Refer to below detailed bits definition</p></td>
</tr>
</tbody>
</table>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Library/DebugLib.h">https://github.com/tianocore/edk2/blob/master/MdePkg/Include/Library/DebugLib.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span>
<span class="o">//</span> <span class="n">Declare</span> <span class="n">bits</span> <span class="k">for</span> <span class="n">errorlevel</span>
<span class="o">//</span>
<span class="c1">#define DEBUG_INIT      0x00000001  // Initialization</span>
<span class="c1">#define DEBUG_WARN      0x00000002  // Warnings</span>
<span class="c1">#define DEBUG_LOAD      0x00000004  // Load events</span>
<span class="c1">#define DEBUG_FS        0x00000008  // EFI File system</span>
<span class="c1">#define DEBUG_POOL      0x00000010  // Alloc &amp; Free (pool)</span>
<span class="c1">#define DEBUG_PAGE      0x00000020  // Alloc &amp; Free (page)</span>
<span class="c1">#define DEBUG_INFO      0x00000040  // Informational debug messages</span>
<span class="c1">#define DEBUG_DISPATCH  0x00000080  // PEI/DXE/SMM Dispatchers</span>
<span class="c1">#define DEBUG_VARIABLE  0x00000100  // Variable</span>
<span class="c1">#define DEBUG_BM        0x00000400  // Boot Manager</span>
<span class="c1">#define DEBUG_BLKIO     0x00001000  // BlkIo Driver</span>
<span class="c1">#define DEBUG_NET       0x00004000  // Network Io Driver</span>
<span class="c1">#define DEBUG_UNDI      0x00010000  // UNDI Driver</span>
<span class="c1">#define DEBUG_LOADFILE  0x00020000  // LoadFile</span>
<span class="c1">#define DEBUG_EVENT     0x00080000  // Event messages</span>
<span class="c1">#define DEBUG_GCD       0x00100000  // Global Coherency Database changes</span>
<span class="c1">#define DEBUG_CACHE     0x00200000  // Memory range cachability changes</span>
<span class="c1">#define DEBUG_VERBOSE   0x00400000  // Detailed debug messages that may significantly impact boot performance</span>
<span class="c1">#define DEBUG_ERROR     0x80000000  // Error</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>SubNode</p></th>
<th class="head"><p>Property</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Definition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>pcirbinfo</p></td>
<td><p>count</p></td>
<td><p>#number</p></td>
<td><p><a class="reference external" href="mailto:rb&#37;&#52;&#48;#bdf">rb<span>&#64;</span>#bdf</a></p></td>
<td><p>segment</p></td>
<td><p>#number</p></td>
<td><p>Segment number of the root bridge</p></td>
</tr>
<tr class="row-odd"><td rowspan="22"></td>
<td><p>ResourceAssigned</p></td>
<td><p>&lt;boolean&gt;</p></td>
<td rowspan="22"></td>
<td><p>supports</p></td>
<td><p>#number</p></td>
<td><p>Supported attributes. Refer to attributes bits definition below</p></td>
</tr>
<tr class="row-even"><td rowspan="21"></td>
<td rowspan="21"></td>
<td><p>dma_above4g</p></td>
<td><p>&lt;boolean&gt;</p></td>
<td><p>Root bridge supports DMA above 4GB memory when it’s TRUE</p></td>
</tr>
<tr class="row-odd"><td><p>no_ext_config</p></td>
<td><p>&lt;boolean&gt;</p></td>
<td><p>Root bridge supports 256-byte configuration space only when it’s TRUE. Root bridge supports 4K-byte configuration space when it’s FALSE</p></td>
</tr>
<tr class="row-even"><td><p>alloc_attr</p></td>
<td><p>#number</p></td>
<td><p>Allocation attributes. Refer to attributes bits definition below</p></td>
</tr>
<tr class="row-odd"><td><p>bus_base</p></td>
<td><p>#number</p></td>
<td rowspan="3"><p>Bus aperture for the root bridge</p></td>
</tr>
<tr class="row-even"><td><p>bus_limit</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-odd"><td><p>bus_translation</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-even"><td><p>io_base</p></td>
<td><p>#number</p></td>
<td rowspan="3"><p>IO aperture for the root bridge</p></td>
</tr>
<tr class="row-odd"><td><p>io_limit</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-even"><td><p>io_translation</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-odd"><td><p>mem_base</p></td>
<td><p>#number</p></td>
<td rowspan="3"><p>MMIO aperture below 4GB for the root bridge</p></td>
</tr>
<tr class="row-even"><td><p>mem_limit</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-odd"><td><p>mem_translation</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-even"><td><p>mem_4g_base</p></td>
<td><p>#number</p></td>
<td rowspan="3"><p>MMIO aperture above 4GB for the root bridge</p></td>
</tr>
<tr class="row-odd"><td><p>mem_4g_limit</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-even"><td><p>mem_4g_translation</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-odd"><td><p>pm_base</p></td>
<td><p>#number</p></td>
<td rowspan="6"><p>Prefetchable MMIO aperture below 4GB for the root bridge</p></td>
</tr>
<tr class="row-even"><td><p>pm_limit</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-odd"><td><p>pm_translation</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-even"><td><p>pm_4g_base</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-odd"><td><p>pm_4g_limit</p></td>
<td><p>#number</p></td>
</tr>
<tr class="row-even"><td><p>pm_4g_translation</p></td>
<td><p>#number</p></td>
</tr>
</tbody>
</table>
<p><a class="reference external" href="https://github.com/tianocore/edk2/blob/master/MdeModulePkg/Include/Library/PciHostBridgeLib.h">https://github.com/tianocore/edk2/blob/master/MdeModulePkg/Include/Library/PciHostBridgeLib.h</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span>
<span class="o">//</span> <span class="n">PCI</span> <span class="n">Attributes</span>
<span class="o">//</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_ISA_MOTHERBOARD_IO    0x0001</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_ISA_IO                0x0002</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_VGA_PALETTE_IO        0x0004</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_VGA_MEMORY            0x0008</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_VGA_IO                0x0010</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_IDE_PRIMARY_IO        0x0020</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_IDE_SECONDARY_IO      0x0040</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_MEMORY_WRITE_COMBINE  0x0080</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_MEMORY_CACHED         0x0800</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_MEMORY_DISABLE        0x1000</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_DUAL_ADDRESS_CYCLE    0x8000</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_ISA_IO_16             0x10000</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_VGA_PALETTE_IO_16     0x20000</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_VGA_IO_16             0x40000</span>

<span class="c1">#define EFI_PCI_ATTRIBUTE_VALID_FOR_ALLOCATE_BUFFER  (EFI_PCI_ATTRIBUTE_MEMORY_WRITE_COMBINE | EFI_PCI_ATTRIBUTE_MEMORY_CACHED | EFI_PCI_ATTRIBUTE_DUAL_ADDRESS_CYCLE)</span>
<span class="c1">#define EFI_PCI_ATTRIBUTE_INVALID_FOR_ALLOCATE_BUFFER  (~EFI_PCI_ATTRIBUTE_VALID_FOR_ALLOCATE_BUFFER)</span>

<span class="o">//</span>
<span class="o">//</span> <span class="n">Allocation</span> <span class="n">Attributes</span>
<span class="o">//</span>
<span class="o">///</span> <span class="n">If</span> <span class="n">this</span> <span class="n">bit</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="n">PCI</span> <span class="n">Root</span> <span class="n">Bridge</span> <span class="n">does</span> <span class="ow">not</span>
<span class="o">///</span> <span class="n">support</span> <span class="n">separate</span> <span class="n">windows</span> <span class="k">for</span> <span class="n">Non</span><span class="o">-</span><span class="n">prefetchable</span> <span class="ow">and</span> <span class="n">Prefetchable</span>
<span class="o">///</span> <span class="n">memory</span><span class="o">.</span> <span class="n">A</span> <span class="n">PCI</span> <span class="n">bus</span> <span class="n">driver</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">include</span> <span class="n">requests</span> <span class="k">for</span> <span class="n">Prefetchable</span>
<span class="o">///</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">Non</span><span class="o">-</span><span class="n">prefetchable</span> <span class="n">memory</span> <span class="n">pool</span><span class="o">.</span>
<span class="o">///</span>
<span class="c1">#define EFI_PCI_HOST_BRIDGE_COMBINE_MEM_PMEM  1</span>

<span class="o">///</span>
<span class="o">///</span> <span class="n">If</span> <span class="n">this</span> <span class="n">bit</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="n">PCI</span> <span class="n">Root</span> <span class="n">Bridge</span> <span class="n">supports</span>
<span class="o">///</span> <span class="mi">64</span> <span class="n">bit</span> <span class="n">memory</span> <span class="n">windows</span><span class="o">.</span>  <span class="n">If</span> <span class="n">this</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">,</span>
<span class="o">///</span> <span class="n">the</span> <span class="n">PCI</span> <span class="n">bus</span> <span class="n">driver</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">include</span> <span class="n">requests</span> <span class="k">for</span> <span class="mi">64</span> <span class="n">bit</span>
<span class="o">///</span> <span class="n">memory</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">corresponding</span> <span class="mi">32</span> <span class="n">bit</span> <span class="n">memory</span> <span class="n">pool</span><span class="o">.</span>
<span class="o">///</span>
<span class="c1">#define EFI_PCI_HOST_BRIDGE_MEM64_DECODE  2</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3><span class="section-number">2.15.3. </span>Hand-off state<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h3>
<p>The bootloader builds the CBOR encoded data containing platform specific information,
and passes the address of the the CBOR encoded data to the payload.</p>
<p>The prototype of payload entry point is defined as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span>
<span class="n">VOID</span>
<span class="p">(</span><span class="o">*</span><span class="n">PAYLOAD_ENTRY</span><span class="p">)</span> <span class="p">(</span>
  <span class="n">VOID</span> <span class="o">*</span> <span class="n">CobrEncodedData</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The compiler need use a proper attributes for this function to meet the calling convention below.
For example, Microsoft Visual studio uses __cdecl for X64, while Linux GCC uses __attribute__((ms_abi)) for X64.</p>
<p>CobrEncodedData is a pointer to CBOR encoded data (see previous section).</p>
</section>
</section>
<section id="references-and-links">
<h2><span class="section-number">2.16. </span>References and Links<a class="headerlink" href="#references-and-links" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a href="https://firmware.intel.com/learn/fsp/about-intel-fsp" target="_blank">Intel® Firmware Support Package</a></p></li>
<li><p><a href="https://github.com/tianocore/tianocore.github.io/wiki/EDK-II-Specifications" target="_blank">EDK II Specifications</a></p></li>
<li><p><a href="http://www.uefi.org/specifications" target="_blank">ACPI</a></p></li>
<li><p><a href="https://www.gnu.org/software/grub/manual/multiboot/multiboot.html" target="_blank">Multiboot Specification</a></p></li>
<li><p><a href="https://buildmedia.readthedocs.org/pdf/devicetree-specification/latest/devicetree-specification.pdf" target="_blank">Devicetree</a></p></li>
<li><p><a href="http://download.microsoft.com/download/9/4/5/945703CA-EF1F-496F-ADCF-3332CE5594FD/microsoft-debug-port-table-2-CP.docx" target="_blank">ACPI DBG2</a></p></li>
</ul>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="3_platform_orchestration_layer.html" class="btn btn-neutral float-right" title="3. Platform Orchestration Layer (POL)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="1_terminology.html" class="btn btn-neutral float-left" title="1. Universal Scalable Firmware (USF) Specification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Content on this site is licensed under a Creative Commons Attribution 4.0 International license.
      <span class="lastupdated">
        Last updated on Jun 01, 2023.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>